<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>In packages • tidyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="In packages">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-archive fa-lg"></span>
     
    R Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../boot/index.html">boot</a>
    </li>
    <li>
      <a href="../../broom/index.html">broom</a>
    </li>
    <li>
      <a href="../../caret/index.html">caret</a>
    </li>
    <li>
      <a href="../../cluster/index.html">cluster</a>
    </li>
    <li>
      <a href="../../coefplot/index.html">coefplot</a>
    </li>
    <li>
      <a href="../../data.table/index.html">data.table</a>
    </li>
    <li>
      <a href="../../devtools/index.html">devtools</a>
    </li>
    <li>
      <a href="../../dplyr/index.html">dplyr</a>
    </li>
    <li>
      <a href="../../e1071/index.html">e1071</a>
    </li>
    <li>
      <a href="../../forcats/index.html">forcats</a>
    </li>
    <li>
      <a href="../../gbm/index.html">gbm</a>
    </li>
    <li>
      <a href="../../ggplot2/index.html">ggplot2</a>
    </li>
    <li>
      <a href="../../glmnet/index.html">glmnet</a>
    </li>
    <li>
      <a href="../../gridExtra/index.html">gridExtra</a>
    </li>
    <li>
      <a href="../../ISLR/index.html">ISLR</a>
    </li>
    <li>
      <a href="../../MASS/index.html">MASS</a>
    </li>
    <li>
      <a href="../../pdp/index.html">pdp</a>
    </li>
    <li>
      <a href="../../pls/index.html">pls</a>
    </li>
    <li>
      <a href="../../plyr/index.html">plyr</a>
    </li>
    <li>
      <a href="../../pROC/index.html">pROC</a>
    </li>
    <li>
      <a href="../../purrr/index.html">purrr</a>
    </li>
    <li>
      <a href="../../randomForest/index.html">randomForest</a>
    </li>
    <li>
      <a href="../../readr/index.html">readr</a>
    </li>
    <li>
      <a href="../../rpart/index.html">rpart</a>
    </li>
    <li>
      <a href="../../rpart.plot/index.html">rpart.plot</a>
    </li>
    <li>
      <a href="../../stringr/index.html">stringr</a>
    </li>
    <li>
      <a href="../../tibble/index.html">tibble</a>
    </li>
    <li>
      <a href="../../tidyr/index.html">tidyr</a>
    </li>
    <li>
      <a href="../../xgboost/index.html">xgboost</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/in-packages.html">In packages</a>
    </li>
    <li>
      <a href="../articles/nest.html">Nested data</a>
    </li>
    <li>
      <a href="../articles/pivot.html">Pivoting</a>
    </li>
    <li>
      <a href="../articles/rectangle.html">Rectangling</a>
    </li>
    <li>
      <a href="../articles/tidy-data.html">Tidy data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tidyverse/tidyr">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>In packages</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/tidyr/blob/master/../../vignettes/in-packages.Rmd"><code>../../vignettes/in-packages.Rmd</code></a></small>
      <div class="hidden name"><code>in-packages.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This vignette serves two distinct, but related, purposes:</p>
<ul>
<li><p>It documents general best practices for using tidyr in a package, inspired by <a href="https://ggplot2.tidyverse.org/dev/articles/ggplot2-in-packages.html">using ggplot2 in packages</a>.</p></li>
<li><p>It describes migration patterns for the transition from tidyr v0.8.3 to v1.0.0. This release includes breaking changes to <code><a href="../reference/nest.html">nest()</a></code> and <code><a href="../reference/nest.html">unnest()</a></code> in order to increase consistency within tidyr and with the rest of the tidyverse.</p></li>
</ul>
<p>Before we go on, we’ll attach the packages we use, expose the version of tidyr, and make a small dataset to use in examples.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(purrr)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span>(<span class="st">"tidyr"</span>)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; [1] '1.0.0'</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">(mini_iris &lt;-<span class="st"> </span>iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="st">    </span><span class="kw"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="st">    </span>.[<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">51</span>, <span class="dv">52</span>, <span class="dv">101</span>, <span class="dv">102</span>), ])</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#&gt; # A tibble: 6 x 5</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species   </span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;     </span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt; 1          5.1         3.5          1.4         0.2 setosa    </span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">#&gt; 2          4.9         3            1.4         0.2 setosa    </span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#&gt; 3          7           3.2          4.7         1.4 versicolor</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#&gt; 4          6.4         3.2          4.5         1.5 versicolor</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">#&gt; 5          6.3         3.3          6           2.5 virginica </span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">#&gt; 6          5.8         2.7          5.1         1.9 virginica</span></a></code></pre></div>
</div>
<div id="using-tidyr-in-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#using-tidyr-in-packages" class="anchor"></a>Using tidyr in packages</h2>
<p>Compared to dplyr and ggplot2, most tidyr functions have <strong>select semantics</strong> (like <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select()</a></code>), not the more common action semantics (like <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code>, …). This means that you typically provide tidyr functions with an expression that works with column names (like <code><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">starts_with("x")</a></code> or <code>a:c</code>) not with column values (like <code>y = x * 2</code>). As a consequence, it’s worthwhile to clarify the best patterns for calling tidyr functions inside another package.</p>
<p>There are three main cases that you’ll encounter:</p>
<ul>
<li><p>The column names are fixed: use <code><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">one_of("col1", "col2", "col3")</a></code>.</p></li>
<li><p>The column names are in a character vector: use <code><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">one_of(cols)</a></code>.</p></li>
<li><p>The column names are specified by the user, using select syntax: use <code>{{ cols }}</code>.</p></li>
</ul>
<div id="fixed-column-names" class="section level3">
<h3 class="hasAnchor">
<a href="#fixed-column-names" class="anchor"></a>Fixed column names</h3>
<p>If you know the column names, this code works in the same way, in and out of a package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">mini_iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/nest.html">nest</a></span>(</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="dt">petal =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(Petal.Length, Petal.Width), </a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="dt">sepal =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(Sepal.Length, Sepal.Width)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; # A tibble: 3 x 3</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt;   Species             petal          sepal</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt;   &lt;fct&gt;      &lt;list&lt;df[,2]&gt;&gt; &lt;list&lt;df[,2]&gt;&gt;</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; 1 setosa            [2 × 2]        [2 × 2]</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; 2 versicolor        [2 × 2]        [2 × 2]</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; 3 virginica         [2 × 2]        [2 × 2]</span></a></code></pre></div>
<p>But <code>R CMD check</code> will warn about undefined global variables (<code>Petal.Length</code>, <code>Petal.Width</code>, <code>Sepal.Length</code>, and <code>Sepal.Width</code>), because it doesn’t know that <code><a href="../reference/nest.html">nest()</a></code> is looking for the variables inside of <code>mini_iris</code>.</p>
<p>The easiest way to silence this note is to use <code><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">one_of()</a></code>. <code><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">one_of()</a></code> is a tidyselect helper (like <code><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">starts_with()</a></code>, <code><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">ends_with()</a></code>, etc.) that takes column names stored as strings:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">mini_iris <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/nest.html">nest</a></span>(</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="dt">petal =</span> <span class="kw"><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">one_of</a></span>(<span class="st">"Petal.Length"</span>, <span class="st">"Petal.Width"</span>), </a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="dt">sepal =</span> <span class="kw"><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">one_of</a></span>(<span class="st">"Sepal.Length"</span>, <span class="st">"Sepal.Width"</span>)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; # A tibble: 3 x 3</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt;   Species             petal          sepal</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt;   &lt;fct&gt;      &lt;list&lt;df[,2]&gt;&gt; &lt;list&lt;df[,2]&gt;&gt;</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="co">#&gt; 1 setosa            [2 × 2]        [2 × 2]</span></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co">#&gt; 2 versicolor        [2 × 2]        [2 × 2]</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="co">#&gt; 3 virginica         [2 × 2]        [2 × 2]</span></a></code></pre></div>
<p>The <a href="https://tidyselect.r-lib.org">tidyselect</a> package offers an entire family of select helpers. You are probably already familiar with them from using <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select()</a></code>.</p>
</div>
<div id="column-names-in-a-character-vector" class="section level3">
<h3 class="hasAnchor">
<a href="#column-names-in-a-character-vector" class="anchor"></a>Column names in a character vector</h3>
<p>If the column names are in a character vector (possibly from a function call), you can provide that to <code><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">one_of()</a></code>, as above:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">nest_egg &lt;-<span class="st"> </span><span class="cf">function</span>(data, cols) {</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="kw"><a href="../reference/nest.html">nest</a></span>(data, <span class="dt">egg =</span> <span class="kw"><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">one_of</a></span>(cols))</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="kw">nest_egg</span>(mini_iris, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Petal.Length"</span>, <span class="st">"Petal.Width"</span>, <span class="st">"Sepal.Length"</span>, <span class="st">"Sepal.Width"</span>))</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt;   Species               egg</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt;   &lt;fct&gt;      &lt;list&lt;df[,4]&gt;&gt;</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; 1 setosa            [2 × 4]</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; 2 versicolor        [2 × 4]</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; 3 virginica         [2 × 4]</span></a></code></pre></div>
<p>The use of <code><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">one_of()</a></code> here is important; if you don’t use it, and <code>data</code> contains a column named <code>cols</code>, <code><a href="../reference/nest.html">nest()</a></code> will nest it instead of the columns named in <code>cols</code>.</p>
</div>
<div id="tidyselect-interface" class="section level3">
<h3 class="hasAnchor">
<a href="#tidyselect-interface" class="anchor"></a>tidyselect interface</h3>
<p>To provide an interface that works like the tidyr function that you’re wrapping, you should pass the argument along using <code>{{ arg }}</code>. <code>{{ }}</code> is a special tidy eval operator that captures the expression supplied by the user and forwards it to another tidy eval-enabled function.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">nest_egg &lt;-<span class="st"> </span><span class="cf">function</span>(df, cols) {</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">  <span class="kw"><a href="../reference/nest.html">nest</a></span>(df, <span class="dt">egg =</span> {{ cols }})</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="kw">nest_egg</span>(mini_iris, <span class="op">-</span>Species)</a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co">#&gt;   Species               egg</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co">#&gt;   &lt;fct&gt;      &lt;list&lt;df[,4]&gt;&gt;</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="co">#&gt; 1 setosa            [2 × 4]</span></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co">#&gt; 2 versicolor        [2 × 4]</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11"><span class="co">#&gt; 3 virginica         [2 × 4]</span></a></code></pre></div>
<p>For more complicated functions, you might want to use tidyselect directly:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">sel_vars &lt;-<span class="st"> </span><span class="cf">function</span>(df, cols) {</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  tidyselect<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/tidyselect/man/vars_select.html">vars_select</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(df), {{ cols }})</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="kw">sel_vars</span>(mini_iris, <span class="op">-</span>Species)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt;   Sepal.Length    Sepal.Width   Petal.Length    Petal.Width </span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co">#&gt; "Sepal.Length"  "Sepal.Width" "Petal.Length"  "Petal.Width"</span></a></code></pre></div>
<p>(Many tidyr functions use <code>...</code> so you can easily select many variables, e.g. <code><a href="../reference/fill.html">fill(df, x, y, z)</a></code>. I now believe that the disadvantages of this approach outweigh the benefits, and that this interface would have been better as <code><a href="../reference/fill.html">fill(df, c(x, y, z))</a></code>. For new functions that select columns, please just use a single argument and not <code>...</code>.)</p>
<p>If you decide to support tidyselect syntax, I recommend re-exporting the select helpers so that users can use (e.g.) <code><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">starts_with()</a></code> without any extra work. There’s no helper to <a href="https://github.com/r-lib/usethis/issues/868">do this yet</a>, but you can copy-and-paste the code that <a href="https://github.com/tidyverse/tidyr/blob/00a66b44d2f304a73e953dd73139db61ed9cc289/R/tidyr.R#L29-L53">tidyr uses</a>.</p>
</div>
<div id="travis-ci" class="section level3">
<h3 class="hasAnchor">
<a href="#travis-ci" class="anchor"></a>Travis-CI</h3>
<p>Hopefully you’ve already adopted continuous integration for your package, in which <code>R CMD check</code> (which includes your own tests) is run on a regular basis, e.g. every time you push changes to your package’s source on GitHub or similar. The tidyverse team currently relies most heavily on Travis-CI for this, so that will be our example. <code><a href="https://usethis.r-lib.org/reference/ci.html">usethis::use_travis()</a></code> can help you get started.</p>
<p>We recommend adding a build to your matrix that targets the devel version of tidyr:</p>
<ul>
<li><p>Always? If your package is tightly coupled to tidyr, consider leaving this build in place all the time, so you know if changes in tidyr affect your package. Modifiers like <code>allow_failures</code> and <code>fast_finish</code> may be useful. Read more about the <a href="https://docs.travis-ci.com/user/customizing-the-build/#build-matrix">Travis build matrix</a>.</p></li>
<li><p>Right before a tidyr release? For everyone else, you could just add a tidyr-devel build during the period preceding a major tidyr release that has the potential for breaking changes, especially if you’ve been contacted during our reverse dependency checks.</p></li>
</ul>
<p>Example of <code>.travis.yml</code> config that tests against R devel, release, and oldrel, assesses test coverage, and includes a build against devel tidyr:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode yaml"><code class="sourceCode yaml"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># R for travis: see documentation at https://docs.travis-ci.com/user/languages/r</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="fu">language:</span><span class="at"> R</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="fu">cache:</span><span class="at"> packages</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="fu">matrix:</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7">  <span class="fu">include:</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8">  <span class="kw"><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></span> <span class="fu">r:</span><span class="at"> devel</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9">  <span class="kw"><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></span> <span class="fu">r:</span><span class="at"> release</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10">    <span class="fu">after_success:</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11">    <span class="kw"><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></span> <span class="fu">Rscript -e 'covr:</span><span class="at">:codecov()'</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12">  <span class="kw"><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></span> <span class="fu">r:</span><span class="at"> release</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13">    <span class="fu">name:</span><span class="at"> tidyr-devel</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14">    <span class="fu">before_script:</span><span class="at"> Rscript -e "remotes::install_github('tidyverse/tidyr')"</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15">  <span class="kw"><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></span> <span class="fu">r:</span><span class="at"> oldrel</span></a></code></pre></div>
</div>
</div>
<div id="tidyr-v0-8-3---v1-0-0" class="section level2">
<h2 class="hasAnchor">
<a href="#tidyr-v0-8-3---v1-0-0" class="anchor"></a>tidyr v0.8.3 -&gt; v1.0.0</h2>
<p>v1.0.0 (aka v0.8.99.9000) makes considerable changes to the interface of <code><a href="../reference/nest.html">nest()</a></code> and <code><a href="../reference/nest.html">unnest()</a></code> in order to bring them in line with newer tidyverse conventions. I have tried to make the functions as backward compatible as possible and to give informative warning messages, but I could not cover 100% of use cases, so you may need to change your package code. This guide will help you do so with a minimum of pain.</p>
<p>Ideally, you’ll tweak your package so that it works with both tidyr 0.8.3 and tidyr 1.0.0. This makes life considerably easier because it means there’s no need to coordinate CRAN submissions - you can submit your package that works with both tidyr versions, before I submit tidyr to CRAN. This section describes our recommend practices for doing so, drawing from the general principles described in <a href="https://principles.tidyverse.org/changes-multivers.html" class="uri">https://principles.tidyverse.org/changes-multivers.html</a>.</p>
<p>If you use Travis-CI already, we <strong>strongly</strong> recommend adding a build that tests with the development version of tidyr; see above for details.</p>
<p>This section briefly describes how to run different code for different versions of tidyr, then goes through the major changes that might require workarounds:</p>
<ul>
<li>
<code><a href="../reference/nest.html">nest()</a></code> and <code><a href="../reference/nest.html">unnest()</a></code> get new interfaces.</li>
<li>
<code><a href="../reference/nest.html">nest()</a></code> preserves groups.</li>
<li>
<code><a href="../reference/deprecated-se.html">nest_()</a></code> and <code><a href="../reference/deprecated-se.html">unnest_()</a></code> are defunct.</li>
</ul>
<p>If you’re struggling with a problem that’s not described here, please reach out via <a href="https://github.com/tidyverse/tidyr/issues/new">github</a> or <a href="mailto:hadley@rstudio.com">email</a> so we can help out.</p>
<div id="conditional-code" class="section level3">
<h3 class="hasAnchor">
<a href="#conditional-code" class="anchor"></a>Conditional code</h3>
<p>Sometimes you’ll be able to write code that works with v0.8.3 <em>and</em> v1.0.0. But this often requires code that’s not particularly natural for either version and you’d be better off to (temporarily) have separate code paths, each containing non-contrived code. You get to re-use your existing code in the “old” branch, which will eventually be phased out, and write clean, forward-looking code in the “new” branch.</p>
<p>The basic approach looks like this. First you define a function that returns <code>TRUE</code> for new versions of tidyr:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">tidyr_new_interface &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/utils/packageDescription.html">packageVersion</a></span>(<span class="st">"tidyr"</span>) <span class="op">&gt;</span><span class="st"> "0.8.99"</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">}</a></code></pre></div>
<p>We highly recommend keeping this as a function because it provides an obvious place to jot any transition notes for your package, and it makes it easier to remove transitional code later on. Another benefit is that the tidyr version is determined at <em>run time</em>, not at <em>build time</em>, and will therefore detect your user’s current tidyr version.</p>
<p>Then in your functions, you use an <code>if</code> statement to call different code for different versions:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">my_function_inside_a_package &lt;-<span class="st"> </span><span class="cf">function</span>(...)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  <span class="co"># my code here</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">  <span class="cf">if</span> (<span class="kw">tidyr_new_interface</span>()) {</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">    <span class="co"># Freshly written code for v1.0.0</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">    out &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span>(df, <span class="dt">data =</span> <span class="kw"><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">one_of</a></span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>))</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">    <span class="co"># Existing code for v0.8.3</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">    out &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span>(df, x, y, z)</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">  }</a>
<a class="sourceLine" id="cb9-11" data-line-number="11"></a>
<a class="sourceLine" id="cb9-12" data-line-number="12">  <span class="co"># more code here</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="er">}</span></a></code></pre></div>
<p>If your new code uses a function that only exists in tidyr 1.0.0, you will get a <code>NOTE</code> from <code>R CMD check</code>: this is one of the few notes that you can explain in your CRAN submission comments. Just mention that it’s for forward compatibility with tidyr 1.0.0, and CRAN will let your package through.</p>
</div>
<div id="new-syntax-for-nest" class="section level3">
<h3 class="hasAnchor">
<a href="#new-syntax-for-nest" class="anchor"></a>New syntax for <code>nest()</code>
</h3>
<p>What changed:</p>
<ul>
<li>The to-be-nested columns are no longer accepted as “loose parts”.</li>
<li>The new list-column’s name is no longer provided via the <code>.key</code> argument.</li>
<li>Now we use a construct like this: <code>new_col = &lt;something about existing cols&gt;</code>.</li>
</ul>
<p>Why it changed:</p>
<ul>
<li><p>The use of <code>...</code> for metadata is a problematic pattern we’re moving away from. <a href="https://principles.tidyverse.org/dots-data.html" class="uri">https://principles.tidyverse.org/dots-data.html</a></p></li>
<li>
<p>The <code>new_col = &lt;something about existing cols&gt;</code> construct lets us create multiple nested list-columns at once (“multi-nest”).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">mini_iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/nest.html">nest</a></span>(<span class="dt">petal =</span> <span class="kw"><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">matches</a></span>(<span class="st">"Petal"</span>), <span class="dt">sepal =</span> <span class="kw"><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">matches</a></span>(<span class="st">"Sepal"</span>)) </a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#&gt; # A tibble: 3 x 3</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co">#&gt;   Species             petal          sepal</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="co">#&gt;   &lt;fct&gt;      &lt;list&lt;df[,2]&gt;&gt; &lt;list&lt;df[,2]&gt;&gt;</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; 1 setosa            [2 × 2]        [2 × 2]</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; 2 versicolor        [2 × 2]        [2 × 2]</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; 3 virginica         [2 × 2]        [2 × 2]</span></a></code></pre></div>
</li>
</ul>
<p>Before and after examples:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># v0.8.3</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">mini_iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/nest.html">nest</a></span>(Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, <span class="dt">.key =</span> <span class="st">"my_data"</span>)</a>
<a class="sourceLine" id="cb11-4" data-line-number="4"></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co"># v1.0.0</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6">mini_iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="../reference/nest.html">nest</a></span>(<span class="dt">my_data =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(Sepal.Length, Sepal.Width, Petal.Length, Petal.Width))</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co"># v1.0.0 avoiding R CMD check </span><span class="al">NOTE</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10">mini_iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="../reference/nest.html">nest</a></span>(<span class="dt">my_data =</span> <span class="kw"><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">one_of</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Sepal.Length"</span>, <span class="st">"Sepal.Width"</span>, <span class="st">"Petal.Length"</span>, <span class="st">"Petal.Width"</span>)))</a>
<a class="sourceLine" id="cb11-12" data-line-number="12"></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co"># or equivalently:</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14">mini_iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="../reference/nest.html">nest</a></span>(<span class="dt">my_data =</span> <span class="op">-</span><span class="kw"><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">one_of</a></span>(<span class="st">"Species"</span>))</a></code></pre></div>
<p>If you need a quick and dirty fix without having to think, just call <code><a href="../reference/nest_legacy.html">nest_legacy()</a></code> instead of <code><a href="../reference/nest.html">nest()</a></code>. It’s the same as <code><a href="../reference/nest.html">nest()</a></code> in v0.8.3:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="cf">if</span> (<span class="kw">tidyr_new_interface</span>()) {</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  out &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/nest_legacy.html">nest_legacy</a></span>(df, x, y, z)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">  out &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/nest.html">nest</a></span>(df, x, y, z)</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">}</a></code></pre></div>
</div>
<div id="new-syntax-for-unnest" class="section level3">
<h3 class="hasAnchor">
<a href="#new-syntax-for-unnest" class="anchor"></a>New syntax for <code>unnest()</code>
</h3>
<p>What changed:</p>
<ul>
<li><p>The to-be-unnested columns must now be specified explicitly, instead of defaulting to all list-columns. This also deprecates <code>.drop</code> and <code>.preserve</code>.</p></li>
<li><p><code>.sep</code> has been deprecated and replaced with <code>names_sep</code>.</p></li>
<li><p><code><a href="../reference/nest.html">unnest()</a></code> uses the <a href="https://www.tidyverse.org/articles/2019/01/tibble-2.0.1/#name-repair">emerging tidyverse standard</a> to disambiguate duplicated names. Use <code>names_repair = tidyr_legacy</code> to request the previous approach.</p></li>
<li>
<p><code>.id</code> has been deprecated because it can be easily replaced by creating the column of names prior to <code><a href="../reference/nest.html">unnest()</a></code>, e.g. with an upstream call to <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># v0.8.3</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/nest.html">unnest</a></span>(x, <span class="dt">.id =</span> <span class="st">"id"</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co"># v1.0.0</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5">df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">id =</span> <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(x)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/nest.html">unnest</a></span>(x)<span class="er">)</span></a></code></pre></div>
</li>
</ul>
<p>Why it changed:</p>
<ul>
<li><p>The use of <code>...</code> for metadata is a problematic pattern we’re moving away from. <a href="https://principles.tidyverse.org/dots-data.html" class="uri">https://principles.tidyverse.org/dots-data.html</a></p></li>
<li><p>The changes to details arguments relate to features rolling out across multiple packages in the tidyverse. For example, <code>ptype</code> exposes protoype support from the new <a href="https://vctrs.r-lib.org">vctrs package</a>. <code>names_repair</code> specifies what to do about duplicated or non-syntactic names, consistent with tibble and readxl.</p></li>
</ul>
<p>Before and after:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">nested &lt;-<span class="st"> </span>mini_iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/nest.html">nest</a></span>(<span class="dt">my_data =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(Sepal.Length, Sepal.Width, Petal.Length, Petal.Width))</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co"># v0.8.3 automatically unnests list-cols</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5">nested <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/nest.html">unnest</a></span>()</a>
<a class="sourceLine" id="cb14-6" data-line-number="6"></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co"># v1.0.0 must be told which columns to unnest</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8">nested <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/nest.html">unnest</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">one_of</a></span>(<span class="st">"my_data"</span>))</a></code></pre></div>
<p>If you need a quick and dirty fix without having to think, just call <code><a href="../reference/nest_legacy.html">unnest_legacy()</a></code> instead of <code><a href="../reference/nest.html">unnest()</a></code>. It’s the same as <code><a href="../reference/nest.html">unnest()</a></code> in v0.8.3:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="cf">if</span> (<span class="kw">tidyr_new_interface</span>()) {</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">  out &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/nest_legacy.html">unnest_legacy</a></span>(df)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">  out &lt;-<span class="st"> </span>tidyr<span class="op">::</span><span class="kw"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span>(df)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">}</a></code></pre></div>
</div>
<div id="nest-preserves-groups" class="section level3">
<h3 class="hasAnchor">
<a href="#nest-preserves-groups" class="anchor"></a><code>nest()</code> preserves groups</h3>
<p>What changed:</p>
<ul>
<li>
<code><a href="../reference/nest.html">nest()</a></code> now preserves the groups present in the input.</li>
</ul>
<p>Why it changed:</p>
<ul>
<li>To reflect the growing support for grouped data frames, especially in recent releases of dplyr. See, for example, <code><a href="https://dplyr.tidyverse.org/reference/group_map.html">dplyr::group_modify()</a></code>, <code><a href="https://dplyr.tidyverse.org/reference/group_map.html">group_map()</a></code>, and friends.</li>
</ul>
<p>If the fact that <code><a href="../reference/nest.html">nest()</a></code> now preserves groups is problematic downstream, you have a few choices:</p>
<ul>
<li><p>Apply <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code> to the result. This level of pragmatism suggests, however, you should at least consider the next two options.</p></li>
<li><p>You should never have grouped in the first place. Eliminate the <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> call and specify which columns should be nested versus not nested directly in <code><a href="../reference/nest.html">nest()</a></code>.</p></li>
<li><p>Adjust the downstream code to accommodate grouping.</p></li>
</ul>
<p>Imagine we used <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> then <code><a href="../reference/nest.html">nest()</a></code> on <code>mini_iris</code>, then we computed on the list-column <em>outside the data frame</em>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">(df &lt;-<span class="st"> </span>mini_iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="st">   </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(Species) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="st">   </span><span class="kw"><a href="../reference/nest.html">nest</a></span>())</a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="co">#&gt; # Groups:   Species [3]</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co">#&gt;   Species              data</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="co">#&gt;   &lt;fct&gt;      &lt;list&lt;df[,4]&gt;&gt;</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="co">#&gt; 1 setosa            [2 × 4]</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co">#&gt; 2 versicolor        [2 × 4]</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co">#&gt; 3 virginica         [2 × 4]</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11">(external_variable &lt;-<span class="st"> </span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_int</a></span>(df<span class="op">$</span>data, nrow))</a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co">#&gt; [1] 2 2 2</span></a></code></pre></div>
<p>And now we try to add that back to the data <em>post hoc</em>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">n_rows =</span> external_variable)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="co">#&gt; Error: Column `n_rows` must be length 1 (the group size), not 3</span></a></code></pre></div>
<p>This fails because <code>df</code> is grouped and <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> is group-aware, so it’s hard to add a completely external variable. Other than pragmatically <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup()</a></code>ing, what can we do? One option is to work inside the data frame, i.e. bring the <code><a href="https://purrr.tidyverse.org/reference/map.html">map()</a></code> inside the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code>, and design the problem away:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">n_rows =</span> <span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map_int</a></span>(data, nrow))</a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="co">#&gt; # A tibble: 3 x 3</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="co">#&gt; # Groups:   Species [3]</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="co">#&gt;   Species              data n_rows</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="co">#&gt;   &lt;fct&gt;      &lt;list&lt;df[,4]&gt;&gt;  &lt;int&gt;</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="co">#&gt; 1 setosa            [2 × 4]      2</span></a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co">#&gt; 2 versicolor        [2 × 4]      2</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="co">#&gt; 3 virginica         [2 × 4]      2</span></a></code></pre></div>
<p>If, somehow, the grouping seems appropriate AND working inside the data frame is not an option, <code><a href="https://tibble.tidyverse.org/reference/add_column.html">tibble::add_column()</a></code> is group-unaware. It lets you add external data to a grouped data frame.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="st">  </span>tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/add_column.html">add_column</a></span>(<span class="dt">n_rows =</span> external_variable)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co">#&gt; # A tibble: 3 x 3</span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co">#&gt; # Groups:   Species [3]</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co">#&gt;   Species              data n_rows</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="co">#&gt;   &lt;fct&gt;      &lt;list&lt;df[,4]&gt;&gt;  &lt;int&gt;</span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="co">#&gt; 1 setosa            [2 × 4]      2</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="co">#&gt; 2 versicolor        [2 × 4]      2</span></a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="co">#&gt; 3 virginica         [2 × 4]      2</span></a></code></pre></div>
</div>
<div id="nest_-and-unnest_-are-defunct" class="section level3">
<h3 class="hasAnchor">
<a href="#nest_-and-unnest_-are-defunct" class="anchor"></a><code>nest_()</code> and <code>unnest_()</code> are defunct</h3>
<p>What changed:</p>
<ul>
<li>
<code><a href="../reference/deprecated-se.html">nest_()</a></code> and <code><a href="../reference/deprecated-se.html">unnest_()</a></code> no longer work</li>
</ul>
<p>Why it changed:</p>
<ul>
<li>We are transitioning the whole tidyverse to the powerful tidy eval framework. Therefore, we are gradually removing all previous solutions:
<ul>
<li>Specialized standard evaluation versions of functions, e.g., <code>foo_()</code> as a complement to <code>foo()</code>.</li>
<li>The older lazyeval framework.</li>
</ul>
</li>
</ul>
<p>Before and after:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="co"># v0.8.3</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2">mini_iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/deprecated-se.html">nest_</a></span>(</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">    <span class="dt">key_col =</span> <span class="st">"my_data"</span>,</a>
<a class="sourceLine" id="cb20-5" data-line-number="5">    <span class="dt">nest_cols =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Sepal.Length"</span>, <span class="st">"Sepal.Width"</span>, <span class="st">"Petal.Length"</span>, <span class="st">"Petal.Width"</span>)</a>
<a class="sourceLine" id="cb20-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb20-7" data-line-number="7"></a>
<a class="sourceLine" id="cb20-8" data-line-number="8">nested <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/deprecated-se.html">unnest_</a></span>(<span class="op">~</span><span class="st"> </span>my_data)</a>
<a class="sourceLine" id="cb20-9" data-line-number="9"></a>
<a class="sourceLine" id="cb20-10" data-line-number="10"><span class="co"># v1.0.0</span></a>
<a class="sourceLine" id="cb20-11" data-line-number="11">mini_iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="../reference/nest.html">nest</a></span>(<span class="dt">my_data =</span> <span class="kw"><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">one_of</a></span>(<span class="st">"Sepal.Length"</span>, <span class="st">"Sepal.Width"</span>, <span class="st">"Petal.Length"</span>, <span class="st">"Petal.Width"</span>))</a>
<a class="sourceLine" id="cb20-13" data-line-number="13"></a>
<a class="sourceLine" id="cb20-14" data-line-number="14">nested <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/nest.html">unnest</a></span>(<span class="kw"><a href="https://rdrr.io/pkg/tidyselect/man/select_helpers.html">one_of</a></span>(<span class="st">"my_data"</span>))</a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#using-tidyr-in-packages">Using tidyr in packages</a></li>
      <li><a href="#tidyr-v0-8-3---v1-0-0">tidyr v0.8.3 -&gt; v1.0.0</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://hadley.nz">Hadley Wickham</a>, Lionel Henry.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
