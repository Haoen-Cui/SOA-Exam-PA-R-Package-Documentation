<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coxnet: Regularized Cox Regression • glmnet</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Coxnet: Regularized Cox Regression">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">glmnet</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-archive fa-lg"></span>
     
    R Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../boot/index.html">boot</a>
    </li>
    <li>
      <a href="../../broom/index.html">broom</a>
    </li>
    <li>
      <a href="../../caret/index.html">caret</a>
    </li>
    <li>
      <a href="../../cluster/index.html">cluster</a>
    </li>
    <li>
      <a href="../../coefplot/index.html">coefplot</a>
    </li>
    <li>
      <a href="../../data.table/index.html">data.table</a>
    </li>
    <li>
      <a href="../../devtools/index.html">devtools</a>
    </li>
    <li>
      <a href="../../dplyr/index.html">dplyr</a>
    </li>
    <li>
      <a href="../../e1071/index.html">e1071</a>
    </li>
    <li>
      <a href="../../forcats/index.html">forcats</a>
    </li>
    <li>
      <a href="../../gbm/index.html">gbm</a>
    </li>
    <li>
      <a href="../../ggplot2/index.html">ggplot2</a>
    </li>
    <li>
      <a href="../../glmnet/index.html">glmnet</a>
    </li>
    <li>
      <a href="../../gridExtra/index.html">gridExtra</a>
    </li>
    <li>
      <a href="../../ISLR/index.html">ISLR</a>
    </li>
    <li>
      <a href="../../MASS/index.html">MASS</a>
    </li>
    <li>
      <a href="../../pdp/index.html">pdp</a>
    </li>
    <li>
      <a href="../../pls/index.html">pls</a>
    </li>
    <li>
      <a href="../../plyr/index.html">plyr</a>
    </li>
    <li>
      <a href="../../pROC/index.html">pROC</a>
    </li>
    <li>
      <a href="../../purrr/index.html">purrr</a>
    </li>
    <li>
      <a href="../../randomForest/index.html">randomForest</a>
    </li>
    <li>
      <a href="../../readr/index.html">readr</a>
    </li>
    <li>
      <a href="../../rpart/index.html">rpart</a>
    </li>
    <li>
      <a href="../../rpart.plot/index.html">rpart.plot</a>
    </li>
    <li>
      <a href="../../stringr/index.html">stringr</a>
    </li>
    <li>
      <a href="../../tibble/index.html">tibble</a>
    </li>
    <li>
      <a href="../../tidyr/index.html">tidyr</a>
    </li>
    <li>
      <a href="../../xgboost/index.html">xgboost</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/glmnet.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Coxnet.html">Coxnet: Regularized Cox Regression</a>
    </li>
    <li>
      <a href="../articles/relax.html">Relaxed fits and other additions in `glmnet` 3.0</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Coxnet: Regularized Cox Regression</h1>
                        <h4 class="author">Noah Simon, Jerome Friedman, Trevor Hastie and Rob Tibshirani</h4>
            
            <h4 class="date">2019-12-31</h4>
      
      
      <div class="hidden name"><code>Coxnet.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>We will give a short tutorial on using coxnet. Coxnet is a function which fits the Cox Model regularized by an elastic net penalty. It is used for underdetermined (or nearly underdetermined systems) and chooses a small number of covariates to include in the model. Because the Cox Model is rarely used for actual prediction, we will rather focus on finding and interpretating an appropriate model. We give a simple example of how to format data and run the Cox Model in glmnet with cross validation.</p>
<p>Further details may be found in <span class="citation">Simon et al. (<a href="#ref-coxnet">2011</a>)</span>, <span class="citation">Tibshirani et al. (<a href="#ref-strongrules">2012</a>)</span> and <span class="citation">Simon, Friedman, and Hastie (<a href="#ref-block">2013</a>)</span>.</p>
</div>
<div id="example" class="section level2">
<h2 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h2>
<p>We first load our data and set up the response. In this case <span class="math inline">\(x\)</span> must be an <span class="math inline">\(n\)</span> by <span class="math inline">\(p\)</span> matrix of covariate values — each row corresponds to a patient and each column a covariate. <span class="math inline">\(y\)</span> is an <span class="math inline">\(n\)</span> length vector of failure/censoring times, and status is an <span class="math inline">\(n\)</span> length vector with each entry, a <span class="math inline">\(1\)</span> or a <span class="math inline">\(0\)</span>, indicating whether the corresponding entry in <span class="math inline">\(y\)</span> is indicative of a failure time or right censoring time (<span class="math inline">\(1\)</span> for failure, <span class="math inline">\(0\)</span> for censoring)</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"glmnet"</span>)</a></code></pre></div>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## Loaded glmnet 3.0-1</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"survival"</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">patient.data  &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="st">"assets/coxnet.RDS"</span>)</a></code></pre></div>
<p>We then call our functions to fit with the lasso penalty (<span class="math inline">\(\alpha=1\)</span>), and cross validate. We set maxit = 1000 (increasing the maximum number of iterations to <span class="math inline">\(1000\)</span>) because our data is relatively high dimensional, so more iterations are needed for convergence. In practice, the function will spit out an error if convergence isn’t reached by the maximum number of iterations.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">cv.fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cv.glmnet.html">cv.glmnet</a></span>(patient.data<span class="op">$</span>x, <span class="kw"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(patient.data<span class="op">$</span>time, patient.data<span class="op">$</span>status), <span class="dt">family=</span><span class="st">"cox"</span>, <span class="dt">maxit =</span> <span class="dv">1000</span>)</a></code></pre></div>
<pre><code>## Warning: from glmnet Fortran code (error code -42); Convergence for 42th lambda
## value not reached after maxit=1000 iterations; solutions for larger lambdas
## returned</code></pre>
<pre><code>## Warning: from glmnet Fortran code (error code -37); Convergence for 37th lambda
## value not reached after maxit=1000 iterations; solutions for larger lambdas
## returned</code></pre>
<pre><code>## Warning: from glmnet Fortran code (error code -40); Convergence for 40th lambda
## value not reached after maxit=1000 iterations; solutions for larger lambdas
## returned</code></pre>
<pre><code>## Warning: from glmnet Fortran code (error code -43); Convergence for 43th lambda
## value not reached after maxit=1000 iterations; solutions for larger lambdas
## returned</code></pre>
<pre><code>## Warning: from glmnet Fortran code (error code -39); Convergence for 39th lambda
## value not reached after maxit=1000 iterations; solutions for larger lambdas
## returned</code></pre>
<pre><code>## Warning: from glmnet Fortran code (error code -41); Convergence for 41th lambda
## value not reached after maxit=1000 iterations; solutions for larger lambdas
## returned

## Warning: from glmnet Fortran code (error code -41); Convergence for 41th lambda
## value not reached after maxit=1000 iterations; solutions for larger lambdas
## returned</code></pre>
<pre><code>## Warning: from glmnet Fortran code (error code -45); Convergence for 45th lambda
## value not reached after maxit=1000 iterations; solutions for larger lambdas
## returned</code></pre>
<pre><code>## Warning: from glmnet Fortran code (error code -42); Convergence for 42th lambda
## value not reached after maxit=1000 iterations; solutions for larger lambdas
## returned</code></pre>
<pre><code>## Warning: from glmnet Fortran code (error code -43); Convergence for 43th lambda
## value not reached after maxit=1000 iterations; solutions for larger lambdas
## returned

## Warning: from glmnet Fortran code (error code -43); Convergence for 43th lambda
## value not reached after maxit=1000 iterations; solutions for larger lambdas
## returned</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/glmnet.html">glmnet</a></span>(patient.data<span class="op">$</span>x, <span class="kw"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span>(patient.data<span class="op">$</span>time,patient.data<span class="op">$</span>status), <span class="dt">family =</span>  <span class="st">"cox"</span>, <span class="dt">maxit =</span> <span class="dv">1000</span>)</a></code></pre></div>
<pre><code>## Warning: from glmnet Fortran code (error code -42); Convergence for 42th lambda
## value not reached after maxit=1000 iterations; solutions for larger lambdas
## returned</code></pre>
<p>The Surv function packages the survival data into the form expected by glmnet. Once fit, we can view the optimal <span class="math inline">\(\lambda\)</span> value and a cross validated error plot to help evaluate our model.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(cv.fit)</a></code></pre></div>
<p><img src="Coxnet_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">cv.fit<span class="op">$</span>lambda.min</a></code></pre></div>
<pre><code>## [1] 0.2207638</code></pre>
<p>The left vertical line in our plot shows us where the CV-error curve hits its minimum. The right vertical line shows us the most regularized model with CV-error within<span class="math inline">\(1\)</span>standard deviation of the minimum. In this case, we see that the minimum was achieved by a fairly regularized model, however the right line indicates that the null model (no coefficients included) is within<span class="math inline">\(1\)</span>sd of the minimum. This might lead us to believe that in actuality the covariates are not explaining any variability. For the time being we will concern ourselves with the minimum CV-error model. We can check which covariates our model chose to be active, and see the coefficients of those covariates.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">Coefficients &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span>(fit, <span class="dt">s =</span> cv.fit<span class="op">$</span>lambda.min)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">Active.Index &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/which.html">which</a></span>(Coefficients <span class="op">!=</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">Active.Coefficients  &lt;-<span class="st"> </span>Coefficients[Active.Index]</a></code></pre></div>
<p><code>coef(fit, s = cv.fit\$lambda.min)</code> returns the <span class="math inline">\(p\)</span> length coefficient vector of the solution corresponding to <span class="math inline">\(\lambda =\)</span><code>cv.fit$lambda.min</code>.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">Active.Index</a></code></pre></div>
<pre><code>## [1]  80 394</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">Active.Coefficients</a></code></pre></div>
<pre><code>## [1] 0.36589736 0.07869734</code></pre>
<p>We see that our optimal model chose 2 active covariates (<span class="math inline">\(X80\)</span> and <span class="math inline">\(X394\)</span>) each with a small positive effect on hazard.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-block">
<p>Simon, Noah, Jerome Friedman, and Trevor Hastie. 2013. “A Blockwise Descent Algorithm for Group-Penalized Multiresponse and Multinomial Regression.”</p>
</div>
<div id="ref-coxnet">
<p>Simon, Noah, Jerome Friedman, Trevor Hastie, and Robert Tibshirani. 2011. “Regularization Paths for Cox’s Proportional Hazards Model via Coordinate Descent.” <em>Journal of Statistical Software, Articles</em> 39 (5): 1–13. <a href="https://doi.org/10.18637/jss.v039.i05" class="uri">https://doi.org/10.18637/jss.v039.i05</a>.</p>
</div>
<div id="ref-strongrules">
<p>Tibshirani, Robert, Jacob Bien, Jerome Friedman, Trevor Hastie, Noah Simon, Jonathan Taylor, and Ryan Tibshirani. 2012. “Strong Rules for Discarding Predictors in Lasso-Type Problems.” <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 74 (2): 245–66. <a href="https://doi.org/10.1111/j.1467-9868.2011.01004.x" class="uri">https://doi.org/10.1111/j.1467-9868.2011.01004.x</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#example">Example</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jerome Friedman, Trevor Hastie, Rob Tibshirani, Balasubramanian Narasimhan, Noah Simon.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
