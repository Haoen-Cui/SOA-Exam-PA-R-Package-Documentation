<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create new features from a previously learned model — xgb.create.features • xgboost</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Create new features from a previously learned model — xgb.create.features" />
<meta property="og:description" content="May improve the learning by adding new features to the training data based on the decision trees from a previously learned model." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">xgboost</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.90.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-archive fa-lg"></span>
     
    R Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../../boot/index.html">boot</a>
    </li>
    <li>
      <a href="../../broom/index.html">broom</a>
    </li>
    <li>
      <a href="../../caret/index.html">caret</a>
    </li>
    <li>
      <a href="../../cluster/index.html">cluster</a>
    </li>
    <li>
      <a href="../../coefplot/index.html">coefplot</a>
    </li>
    <li>
      <a href="../../data.table/index.html">data.table</a>
    </li>
    <li>
      <a href="../../devtools/index.html">devtools</a>
    </li>
    <li>
      <a href="../../dplyr/index.html">dplyr</a>
    </li>
    <li>
      <a href="../../e1071/index.html">e1071</a>
    </li>
    <li>
      <a href="../../forcats/index.html">forcats</a>
    </li>
    <li>
      <a href="../../gbm/index.html">gbm</a>
    </li>
    <li>
      <a href="../../ggplot2/index.html">ggplot2</a>
    </li>
    <li>
      <a href="../../glmnet/index.html">glmnet</a>
    </li>
    <li>
      <a href="../../gridExtra/index.html">gridExtra</a>
    </li>
    <li>
      <a href="../../ISLR/index.html">ISLR</a>
    </li>
    <li>
      <a href="../../MASS/index.html">MASS</a>
    </li>
    <li>
      <a href="../../pdp/index.html">pdp</a>
    </li>
    <li>
      <a href="../../pls/index.html">pls</a>
    </li>
    <li>
      <a href="../../plyr/index.html">plyr</a>
    </li>
    <li>
      <a href="../../pROC/index.html">pROC</a>
    </li>
    <li>
      <a href="../../purrr/index.html">purrr</a>
    </li>
    <li>
      <a href="../../randomForest/index.html">randomForest</a>
    </li>
    <li>
      <a href="../../readr/index.html">readr</a>
    </li>
    <li>
      <a href="../../rpart/index.html">rpart</a>
    </li>
    <li>
      <a href="../../rpart.plot/index.html">rpart.plot</a>
    </li>
    <li>
      <a href="../../stringr/index.html">stringr</a>
    </li>
    <li>
      <a href="../../tibble/index.html">tibble</a>
    </li>
    <li>
      <a href="../../tidyr/index.html">tidyr</a>
    </li>
    <li>
      <a href="../../xgboost/index.html">xgboost</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/discoverYourData.html">Understand your dataset with Xgboost</a>
    </li>
    <li>
      <a href="../articles/xgboostPresentation.html">Xgboost presentation</a>
    </li>
    <li>
      <a href="../articles/xgboostfromJSON.html">XGBoost from JSON</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/dmlc/xgboost">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create new features from a previously learned model</h1>
    <small class="dont-index">Source: <a href='https://github.com/dmlc/xgboost/blob/master/R/xgb.create.features.R'><code>R/xgb.create.features.R</code></a></small>
    <div class="hidden name"><code>xgb.create.features.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>May improve the learning by adding new features to the training data based on the decision trees from a previously learned model.</p>
    </div>

    <pre class="usage"><span class='fu'>xgb.create.features</span>(<span class='no'>model</span>, <span class='no'>data</span>, <span class='no'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>model</th>
      <td><p>decision tree boosting model learned on the original data</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>original data (usually provided as a <code>dgCMatrix</code> matrix)</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>currently not used</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>dgCMatrix</code> matrix including both the original data and the new features.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This is the function inspired from the paragraph 3.1 of the paper:</p>
<p><strong>Practical Lessons from Predicting Clicks on Ads at Facebook</strong></p>
<p><em>(Xinran He, Junfeng Pan, Ou Jin, Tianbing Xu, Bo Liu, Tao Xu, Yan, xin Shi, Antoine Atallah, Ralf Herbrich, Stuart Bowers, 
Joaquin Quinonero Candela)</em></p> 
<p>International Workshop on Data Mining for Online Advertising (ADKDD) - August 24, 2014</p>
<p><a href='https://research.fb.com/publications/practical-lessons-from-predicting-clicks-on-ads-at-facebook/'>https://research.fb.com/publications/practical-lessons-from-predicting-clicks-on-ads-at-facebook/</a>.</p>
<p>Extract explaining the method:</p>
<p>"We found that boosted decision trees are a powerful and very
convenient way to implement non-linear and tuple transformations
of the kind we just described. We treat each individual
tree as a categorical feature that takes as value the
index of the leaf an instance ends up falling in. We use 
1-of-K coding of this type of features.</p>
<p>For example, consider the boosted tree model in Figure 1 with 2 subtrees, 
where the first subtree has 3 leafs and the second 2 leafs. If an
instance ends up in leaf 2 in the first subtree and leaf 1 in
second subtree, the overall input to the linear classifier will
be the binary vector <code>[0, 1, 0, 1, 0]</code>, where the first 3 entries
correspond to the leaves of the first subtree and last 2 to
those of the second subtree.</p>
<p>[...]</p>
<p>We can understand boosted decision tree
based transformation as a supervised feature encoding that
converts a real-valued vector into a compact binary-valued
vector. A traversal from root node to a leaf node represents
a rule on certain features."</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>agaricus.train</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>'xgboost'</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>agaricus.test</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>'xgboost'</span>)
<span class='no'>dtrain</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='xgb.DMatrix.html'>xgb.DMatrix</a></span>(<span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>agaricus.train</span>$<span class='no'>data</span>, <span class='kw'>label</span> <span class='kw'>=</span> <span class='no'>agaricus.train</span>$<span class='no'>label</span>)
<span class='no'>dtest</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='xgb.DMatrix.html'>xgb.DMatrix</a></span>(<span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>agaricus.test</span>$<span class='no'>data</span>, <span class='kw'>label</span> <span class='kw'>=</span> <span class='no'>agaricus.test</span>$<span class='no'>label</span>)

<span class='no'>param</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>max_depth</span><span class='kw'>=</span><span class='fl'>2</span>, <span class='kw'>eta</span><span class='kw'>=</span><span class='fl'>1</span>, <span class='kw'>silent</span><span class='kw'>=</span><span class='fl'>1</span>, <span class='kw'>objective</span><span class='kw'>=</span><span class='st'>'binary:logistic'</span>)
<span class='no'>nrounds</span> <span class='kw'>=</span> <span class='fl'>4</span>

<span class='no'>bst</span> <span class='kw'>=</span> <span class='fu'><a href='xgb.train.html'>xgb.train</a></span>(<span class='kw'>params</span> <span class='kw'>=</span> <span class='no'>param</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>dtrain</span>, <span class='kw'>nrounds</span> <span class='kw'>=</span> <span class='no'>nrounds</span>, <span class='kw'>nthread</span> <span class='kw'>=</span> <span class='fl'>2</span>)

<span class='co'># Model accuracy without new features</span>
<span class='no'>accuracy.before</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>((<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>bst</span>, <span class='no'>agaricus.test</span>$<span class='no'>data</span>) <span class='kw'>&gt;=</span> <span class='fl'>0.5</span>) <span class='kw'>==</span> <span class='no'>agaricus.test</span>$<span class='no'>label</span>) /
                   <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>agaricus.test</span>$<span class='no'>label</span>)

<span class='co'># Convert previous features to one hot encoding</span>
<span class='no'>new.features.train</span> <span class='kw'>&lt;-</span> <span class='fu'>xgb.create.features</span>(<span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>bst</span>, <span class='no'>agaricus.train</span>$<span class='no'>data</span>)
<span class='no'>new.features.test</span> <span class='kw'>&lt;-</span> <span class='fu'>xgb.create.features</span>(<span class='kw'>model</span> <span class='kw'>=</span> <span class='no'>bst</span>, <span class='no'>agaricus.test</span>$<span class='no'>data</span>)

<span class='co'># learning with new features</span>
<span class='no'>new.dtrain</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='xgb.DMatrix.html'>xgb.DMatrix</a></span>(<span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>new.features.train</span>, <span class='kw'>label</span> <span class='kw'>=</span> <span class='no'>agaricus.train</span>$<span class='no'>label</span>)
<span class='no'>new.dtest</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='xgb.DMatrix.html'>xgb.DMatrix</a></span>(<span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>new.features.test</span>, <span class='kw'>label</span> <span class='kw'>=</span> <span class='no'>agaricus.test</span>$<span class='no'>label</span>)
<span class='no'>watchlist</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='kw'>train</span> <span class='kw'>=</span> <span class='no'>new.dtrain</span>)
<span class='no'>bst</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='xgb.train.html'>xgb.train</a></span>(<span class='kw'>params</span> <span class='kw'>=</span> <span class='no'>param</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>new.dtrain</span>, <span class='kw'>nrounds</span> <span class='kw'>=</span> <span class='no'>nrounds</span>, <span class='kw'>nthread</span> <span class='kw'>=</span> <span class='fl'>2</span>)

<span class='co'># Model accuracy with new features</span>
<span class='no'>accuracy.after</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span>((<span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span>(<span class='no'>bst</span>, <span class='no'>new.dtest</span>) <span class='kw'>&gt;=</span> <span class='fl'>0.5</span>) <span class='kw'>==</span> <span class='no'>agaricus.test</span>$<span class='no'>label</span>) /
                  <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>agaricus.test</span>$<span class='no'>label</span>)

<span class='co'># Here the accuracy was already good and is now perfect.</span>
<span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='st'>"The accuracy was"</span>, <span class='no'>accuracy.before</span>, <span class='st'>"before adding leaf features and it is now"</span>,
          <span class='no'>accuracy.after</span>, <span class='st'>"!\n"</span>))</div><div class='output co'>#&gt; The accuracy was 0.981998758535071 before adding leaf features and it is now 1 !</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Tianqi Chen, Tong He, Michael Benesty, Vadim Khotilovich, Yuan Tang, Hyunsu Cho, Kailong Chen, Rory Mitchell, Ignacio Cano, Tianyi Zhou, Mu Li, Junyuan Xie, Min Lin, Yifeng Geng, Yutian Li.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


