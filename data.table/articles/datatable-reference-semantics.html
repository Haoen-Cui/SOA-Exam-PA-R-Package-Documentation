<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reference semantics • data.table</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Reference semantics">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">data.table</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.12.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-archive fa-lg"></span>
     
    R Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../boot/index.html">boot</a>
    </li>
    <li>
      <a href="../../broom/index.html">broom</a>
    </li>
    <li>
      <a href="../../caret/index.html">caret</a>
    </li>
    <li>
      <a href="../../cluster/index.html">cluster</a>
    </li>
    <li>
      <a href="../../coefplot/index.html">coefplot</a>
    </li>
    <li>
      <a href="../../data.table/index.html">data.table</a>
    </li>
    <li>
      <a href="../../devtools/index.html">devtools</a>
    </li>
    <li>
      <a href="../../dplyr/index.html">dplyr</a>
    </li>
    <li>
      <a href="../../e1071/index.html">e1071</a>
    </li>
    <li>
      <a href="../../forcats/index.html">forcats</a>
    </li>
    <li>
      <a href="../../gbm/index.html">gbm</a>
    </li>
    <li>
      <a href="../../ggplot2/index.html">ggplot2</a>
    </li>
    <li>
      <a href="../../glmnet/index.html">glmnet</a>
    </li>
    <li>
      <a href="../../gridExtra/index.html">gridExtra</a>
    </li>
    <li>
      <a href="../../ISLR/index.html">ISLR</a>
    </li>
    <li>
      <a href="../../MASS/index.html">MASS</a>
    </li>
    <li>
      <a href="../../pdp/index.html">pdp</a>
    </li>
    <li>
      <a href="../../pls/index.html">pls</a>
    </li>
    <li>
      <a href="../../plyr/index.html">plyr</a>
    </li>
    <li>
      <a href="../../pROC/index.html">pROC</a>
    </li>
    <li>
      <a href="../../purrr/index.html">purrr</a>
    </li>
    <li>
      <a href="../../randomForest/index.html">randomForest</a>
    </li>
    <li>
      <a href="../../readr/index.html">readr</a>
    </li>
    <li>
      <a href="../../rpart/index.html">rpart</a>
    </li>
    <li>
      <a href="../../rpart.plot/index.html">rpart.plot</a>
    </li>
    <li>
      <a href="../../stringr/index.html">stringr</a>
    </li>
    <li>
      <a href="../../tibble/index.html">tibble</a>
    </li>
    <li>
      <a href="../../tidyr/index.html">tidyr</a>
    </li>
    <li>
      <a href="../../xgboost/index.html">xgboost</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/datatable-benchmarking.html">Benchmarking data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-faq.html">Frequently Asked Questions about data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-importing.html">Importing data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-intro.html">Introduction to data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-keys-fast-subset.html">Keys and fast binary search based subset</a>
    </li>
    <li>
      <a href="../articles/datatable-reference-semantics.html">Reference semantics</a>
    </li>
    <li>
      <a href="../articles/datatable-reshape.html">Efficient reshaping using data.tables</a>
    </li>
    <li>
      <a href="../articles/datatable-sd-usage.html">Using .SD for Data Analysis</a>
    </li>
    <li>
      <a href="../articles/datatable-secondary-indices-and-auto-indexing.html">Secondary indices and auto indexing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Rdatatable/data.table">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Reference semantics</h1>
            
            <h4 class="date">2019-12-31</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Rdatatable/data.table/blob/master/../../vignettes/datatable-reference-semantics.Rmd"><code>../../vignettes/datatable-reference-semantics.Rmd</code></a></small>
      <div class="hidden name"><code>datatable-reference-semantics.Rmd</code></div>

    </div>

    
    
<p>This vignette discusses <em>data.table</em>’s reference semantics which allows to <em>add/update/delete</em> columns of a <em>data.table by reference</em>, and also combine them with <code>i</code> and <code>by</code>. It is aimed at those who are already familiar with <em>data.table</em> syntax, its general form, how to subset rows in <code>i</code>, select and compute on columns, and perform aggregations by group. If you’re not familiar with these concepts, please read the <em>“Introduction to data.table”</em> vignette first.</p>
<hr>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>We will use the same <code>flights</code> data as in the <em>“Introduction to data.table”</em> vignette.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">flights &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fread.html">fread</a></span>(<span class="st">"flights14.csv"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">flights</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#         year month day dep_delay arr_delay carrier origin dest air_time distance hour</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#      1: 2014     1   1        14        13      AA    JFK  LAX      359     2475    9</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#      2: 2014     1   1        -3        13      AA    JFK  LAX      363     2475   11</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#      3: 2014     1   1         2         9      AA    JFK  LAX      351     2475   19</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#      4: 2014     1   1        -8       -26      AA    LGA  PBI      157     1035    7</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#      5: 2014     1   1         2         1      AA    JFK  LAX      350     2475   13</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#     ---                                                                              </span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co"># 253312: 2014    10  31         1       -30      UA    LGA  IAH      201     1416   14</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co"># 253313: 2014    10  31        -5       -14      UA    EWR  IAH      189     1400    8</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co"># 253314: 2014    10  31        -8        16      MQ    LGA  RDU       83      431   11</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co"># 253315: 2014    10  31        -4        15      MQ    LGA  DTW       75      502   11</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co"># 253316: 2014    10  31        -5         1      MQ    LGA  SDF      110      659    8</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="kw"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(flights)</a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co"># [1] 253316     11</span></a></code></pre></div>
</div>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>In this vignette, we will</p>
<ol style="list-style-type: decimal">
<li><p>first discuss reference semantics briefly and look at the two different forms in which the <code>:=</code> operator can be used</p></li>
<li><p>then see how we can <em>add/update/delete</em> columns <em>by reference</em> in <code>j</code> using the <code>:=</code> operator and how to combine with <code>i</code> and <code>by</code>.</p></li>
<li><p>and finally we will look at using <code>:=</code> for its <em>side-effect</em> and how we can avoid the side effects using <code><a href="../reference/copy.html">copy()</a></code>.</p></li>
</ol>
</div>
<div id="reference-semantics" class="section level2">
<h2 class="hasAnchor">
<a href="#reference-semantics" class="anchor"></a>1. Reference semantics</h2>
<p>All the operations we have seen so far in the previous vignette resulted in a new data set. We will see how to <em>add</em> new column(s), <em>update</em> or <em>delete</em> existing column(s) on the original data.</p>
<div id="a-background" class="section level3">
<h3 class="hasAnchor">
<a href="#a-background" class="anchor"></a>a) Background</h3>
<p>Before we look at <em>reference semantics</em>, consider the <em>data.frame</em> shown below:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">DF =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">ID =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"b"</span>,<span class="st">"b"</span>,<span class="st">"b"</span>,<span class="st">"a"</span>,<span class="st">"a"</span>,<span class="st">"c"</span>), <span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">b =</span> <span class="dv">7</span><span class="op">:</span><span class="dv">12</span>, <span class="dt">c =</span> <span class="dv">13</span><span class="op">:</span><span class="dv">18</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">DF</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#   ID a  b  c</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co"># 1  b 1  7 13</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co"># 2  b 2  8 14</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co"># 3  b 3  9 15</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co"># 4  a 4 10 16</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co"># 5  a 5 11 17</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co"># 6  c 6 12 18</span></a></code></pre></div>
<p>When we did:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">DF<span class="op">$</span>c &lt;-<span class="st"> </span><span class="dv">18</span><span class="op">:</span><span class="dv">13</span>               <span class="co"># (1) -- replace entire column</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co"># or</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">DF<span class="op">$</span>c[DF<span class="op">$</span>ID <span class="op">==</span><span class="st"> "b"</span>] &lt;-<span class="st"> </span><span class="dv">15</span><span class="op">:</span><span class="dv">13</span> <span class="co"># (2) -- subassign in column 'c'</span></a></code></pre></div>
<p>both (1) and (2) resulted in deep copy of the entire data.frame in versions of <code>R</code> versions <code>&lt; 3.1</code>. <a href="http://stackoverflow.com/q/23898969/559784">It copied more than once</a>. To improve performance by avoiding these redundant copies, <em>data.table</em> utilised the <a href="http://stackoverflow.com/q/7033106/559784">available but unused <code>:=</code> operator in R</a>.</p>
<p>Great performance improvements were made in <code>R v3.1</code> as a result of which only a <em>shallow</em> copy is made for (1) and not <em>deep</em> copy. However, for (2) still, the entire column is <em>deep</em> copied even in <code>R v3.1+</code>. This means the more columns one subassigns to in the <em>same query</em>, the more <em>deep</em> copies R does.</p>
<div id="shallow-vs-deep-copy" class="section level4 bs-callout bs-callout-info">
<h4 class="hasAnchor">
<a href="#shallow-vs-deep-copy" class="anchor"></a><em>shallow</em> vs <em>deep</em> copy</h4>
<p>A <em>shallow</em> copy is just a copy of the vector of column pointers (corresponding to the columns in a <em>data.frame</em> or <em>data.table</em>). The actual data is not physically copied in memory.</p>
<p>A <em>deep</em> copy on the other hand copies the entire data to another location in memory.</p>
</div>
</div>
</div>
<div id="section" class="section level1">
<h1></h1>
<p>With <em>data.table’s</em> <code>:=</code> operator, absolutely no copies are made in <em>both</em> (1) and (2), irrespective of R version you are using. This is because <code>:=</code> operator updates <em>data.table</em> columns <em>in-place</em> (by reference).</p>
<div id="b-the-operator" class="section level3">
<h3 class="hasAnchor">
<a href="#b-the-operator" class="anchor"></a>b) The <code>:=</code> operator</h3>
<p>It can be used in <code>j</code> in two ways:</p>
<ol style="list-style-type: lower-alpha">
<li>
<p>The <code><a href="../reference/assign.html">LHS := RHS</a></code> form</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">DT[, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"colA"</span>, <span class="st">"colB"</span>, ...) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(valA, valB, ...)]</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co"># when you have only one column to assign to you</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co"># can drop the quotes and list(), for convenience</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">DT[, colA <span class="op">:</span><span class="er">=</span><span class="st"> </span>valA]</a></code></pre></div>
</li>
<li>
<p>The functional form</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">DT[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(<span class="dt">colA =</span> valA, <span class="co"># valA is assigned to colA</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">          <span class="dt">colB =</span> valB, <span class="co"># valB is assigned to colB</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">          ...</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">)]</a></code></pre></div>
</li>
</ol>
<div id="section-1" class="section level4 bs-callout bs-callout-warning">
<h4></h4>
<p>Note that the code above explains how <code>:=</code> can be used. They are not working examples. We will start using them on <code>flights</code> <em>data.table</em> from the next section.</p>
</div>
</div>
</div>
<div id="section-2" class="section level1">
<h1></h1>
<div id="section-3" class="section level4 bs-callout bs-callout-info">
<h4></h4>
<ul>
<li><p>In (a), <code>LHS</code> takes a character vector of column names and <code>RHS</code> a <em>list of values</em>. <code>RHS</code> just needs to be a <code>list</code>, irrespective of how its generated (e.g., using <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code>, <code><a href="https://rdrr.io/r/base/list.html">list()</a></code>, <code><a href="https://rdrr.io/r/base/get.html">mget()</a></code>, <code><a href="https://rdrr.io/r/base/mapply.html">mapply()</a></code> etc.). This form is usually easy to program with and is particularly useful when you don’t know the columns to assign values to in advance.</p></li>
<li><p>On the other hand, (b) is handy if you would like to jot some comments down for later.</p></li>
<li><p>The result is returned <em>invisibly</em>.</p></li>
<li><p>Since <code>:=</code> is available in <code>j</code>, we can combine it with <code>i</code> and <code>by</code> operations just like the aggregation operations we saw in the previous vignette.</p></li>
</ul>
</div>
</div>
<div id="section-4" class="section level1">
<h1></h1>
<p>In the two forms of <code>:=</code> shown above, note that we don’t assign the result back to a variable. Because we don’t need to. The input <em>data.table</em> is modified by reference. Let’s go through examples to understand what we mean by this.</p>
<p>For the rest of the vignette, we will work with <code>flights</code> <em>data.table</em>.</p>
<div id="addupdatedelete-columns-by-reference" class="section level2">
<h2 class="hasAnchor">
<a href="#addupdatedelete-columns-by-reference" class="anchor"></a>2. Add/update/delete columns <em>by reference</em>
</h2>
<div id="ref-j" class="section level3">
<h3 class="hasAnchor">
<a href="#ref-j" class="anchor"></a>a) Add columns by reference</h3>
<div id="how-can-we-add-columns-speed-and-total-delay-of-each-flight-to-flights-data-table" class="section level4">
<h4 class="hasAnchor">
<a href="#how-can-we-add-columns-speed-and-total-delay-of-each-flight-to-flights-data-table" class="anchor"></a>– How can we add columns <em>speed</em> and <em>total delay</em> of each flight to <code>flights</code> <em>data.table</em>?</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">flights[, <span class="st">`</span><span class="dt">:=</span><span class="st">`</span>(<span class="dt">speed =</span> distance <span class="op">/</span><span class="st"> </span>(air_time<span class="op">/</span><span class="dv">60</span>), <span class="co"># speed in mph (mi/h)</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">               <span class="dt">delay =</span> arr_delay <span class="op">+</span><span class="st"> </span>dep_delay)]   <span class="co"># delay in minutes</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(flights)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co">#    year month day dep_delay arr_delay carrier origin dest air_time distance hour    speed delay</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co"># 1: 2014     1   1        14        13      AA    JFK  LAX      359     2475    9 413.6490    27</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co"># 2: 2014     1   1        -3        13      AA    JFK  LAX      363     2475   11 409.0909    10</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="co"># 3: 2014     1   1         2         9      AA    JFK  LAX      351     2475   19 423.0769    11</span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="co"># 4: 2014     1   1        -8       -26      AA    LGA  PBI      157     1035    7 395.5414   -34</span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="co"># 5: 2014     1   1         2         1      AA    JFK  LAX      350     2475   13 424.2857     3</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co"># 6: 2014     1   1         4         0      AA    EWR  LAX      339     2454   18 434.3363     4</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"></a>
<a class="sourceLine" id="cb6-12" data-line-number="12">## alternatively, using the 'LHS := RHS' form</a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co"># flights[, c("speed", "delay") := list(distance/(air_time/60), arr_delay + dep_delay)]</span></a></code></pre></div>
</div>
<div id="note-that" class="section level4 bs-callout bs-callout-info">
<h4 class="hasAnchor">
<a href="#note-that" class="anchor"></a>Note that</h4>
<ul>
<li><p>We did not have to assign the result back to <code>flights</code>.</p></li>
<li><p>The <code>flights</code> <em>data.table</em> now contains the two newly added columns. This is what we mean by <em>added by reference</em>.</p></li>
<li><p>We used the functional form so that we could add comments on the side to explain what the computation does. You can also see the <code><a href="../reference/assign.html">LHS := RHS</a></code> form (commented).</p></li>
</ul>
</div>
</div>
<div id="ref-i-j" class="section level3">
<h3 class="hasAnchor">
<a href="#ref-i-j" class="anchor"></a>b) Update some rows of columns by reference - <em>sub-assign</em> by reference</h3>
<p>Let’s take a look at all the <code>hours</code> available in the <code>flights</code> <em>data.table</em>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># get all 'hours' in flights</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">flights[, <span class="kw"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="kw"><a href="../reference/duplicated.html">unique</a></span>(hour))]</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#  [1]  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24</span></a></code></pre></div>
<p>We see that there are totally <code>25</code> unique values in the data. Both <em>0</em> and <em>24</em> hours seem to be present. Let’s go ahead and replace <em>24</em> with <em>0</em>.</p>
<div id="replace-those-rows-where-hour-24-with-the-value-0" class="section level4">
<h4 class="hasAnchor">
<a href="#replace-those-rows-where-hour-24-with-the-value-0" class="anchor"></a>– Replace those rows where <code>hour == 24</code> with the value <code>0</code>
</h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># subassign by reference</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">flights[hour <span class="op">==</span><span class="st"> </span>24L, hour <span class="op">:</span><span class="er">=</span><span class="st"> </span>0L]</a></code></pre></div>
</div>
<div id="section-5" class="section level4 bs-callout bs-callout-info">
<h4></h4>
<ul>
<li><p>We can use <code>i</code> along with <code>:=</code> in <code>j</code> the very same way as we have already seen in the <em>“Introduction to data.table”</em> vignette.</p></li>
<li><p>Column <code>hour</code> is replaced with <code>0</code> only on those <em>row indices</em> where the condition <code>hour == 24L</code> specified in <code>i</code> evaluates to <code>TRUE</code>.</p></li>
<li>
<p><code>:=</code> returns the result invisibly. Sometimes it might be necessary to see the result after the assignment. We can accomplish that by adding an empty <code>[]</code> at the end of the query as shown below:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">flights[hour <span class="op">==</span><span class="st"> </span>24L, hour <span class="op">:</span><span class="er">=</span><span class="st"> </span>0L][]</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="co">#         year month day dep_delay arr_delay carrier origin dest air_time distance hour    speed</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#      1: 2014     1   1        14        13      AA    JFK  LAX      359     2475    9 413.6490</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="co">#      2: 2014     1   1        -3        13      AA    JFK  LAX      363     2475   11 409.0909</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co">#      3: 2014     1   1         2         9      AA    JFK  LAX      351     2475   19 423.0769</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co">#      4: 2014     1   1        -8       -26      AA    LGA  PBI      157     1035    7 395.5414</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#      5: 2014     1   1         2         1      AA    JFK  LAX      350     2475   13 424.2857</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#     ---                                                                                       </span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co"># 253312: 2014    10  31         1       -30      UA    LGA  IAH      201     1416   14 422.6866</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co"># 253313: 2014    10  31        -5       -14      UA    EWR  IAH      189     1400    8 444.4444</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co"># 253314: 2014    10  31        -8        16      MQ    LGA  RDU       83      431   11 311.5663</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co"># 253315: 2014    10  31        -4        15      MQ    LGA  DTW       75      502   11 401.6000</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co"># 253316: 2014    10  31        -5         1      MQ    LGA  SDF      110      659    8 359.4545</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="co">#         delay</span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="co">#      1:    27</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="co">#      2:    10</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="co">#      3:    11</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="co">#      4:   -34</span></a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="co">#      5:     3</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="co">#     ---      </span></a>
<a class="sourceLine" id="cb9-21" data-line-number="21"><span class="co"># 253312:   -29</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22"><span class="co"># 253313:   -19</span></a>
<a class="sourceLine" id="cb9-23" data-line-number="23"><span class="co"># 253314:     8</span></a>
<a class="sourceLine" id="cb9-24" data-line-number="24"><span class="co"># 253315:    11</span></a>
<a class="sourceLine" id="cb9-25" data-line-number="25"><span class="co"># 253316:    -4</span></a></code></pre></div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="section-6" class="section level1">
<h1></h1>
<p>Let’s look at all the <code>hours</code> to verify.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># check again for '24'</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">flights[, <span class="kw"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="kw"><a href="../reference/duplicated.html">unique</a></span>(hour))]</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="co">#  [1]  0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23</span></a></code></pre></div>
<div id="update-by-reference-question" class="section level4 bs-callout bs-callout-warning">
<h4 class="hasAnchor">
<a href="#update-by-reference-question" class="anchor"></a>Exercise:</h4>
<p>What is the difference between <code>flights[hour == 24L, hour := 0L]</code> and <code>flights[hour == 24L][, hour := 0L]</code>? Hint: The latter needs an assignment (<code>&lt;-</code>) if you would want to use the result later.</p>
<p>If you can’t figure it out, have a look at the <code>Note</code> section of <code><a href="../reference/assign.html">?":="</a></code>.</p>
</div>
<div id="c-delete-column-by-reference" class="section level3">
<h3 class="hasAnchor">
<a href="#c-delete-column-by-reference" class="anchor"></a>c) Delete column by reference</h3>
<div id="remove-delay-column" class="section level4">
<h4 class="hasAnchor">
<a href="#remove-delay-column" class="anchor"></a>– Remove <code>delay</code> column</h4>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">flights[, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"delay"</span>) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(flights)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#    year month day dep_delay arr_delay carrier origin dest air_time distance hour    speed</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co"># 1: 2014     1   1        14        13      AA    JFK  LAX      359     2475    9 413.6490</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co"># 2: 2014     1   1        -3        13      AA    JFK  LAX      363     2475   11 409.0909</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co"># 3: 2014     1   1         2         9      AA    JFK  LAX      351     2475   19 423.0769</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co"># 4: 2014     1   1        -8       -26      AA    LGA  PBI      157     1035    7 395.5414</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co"># 5: 2014     1   1         2         1      AA    JFK  LAX      350     2475   13 424.2857</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co"># 6: 2014     1   1         4         0      AA    EWR  LAX      339     2454   18 434.3363</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"></a>
<a class="sourceLine" id="cb11-11" data-line-number="11">## or using the functional form</a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co"># flights[, `:=`(delay = NULL)]</span></a></code></pre></div>
</div>
<div id="delete-convenience" class="section level4 bs-callout bs-callout-info">
<h4></h4>
<ul>
<li><p>Assigning <code>NULL</code> to a column <em>deletes</em> that column. And it happens <em>instantly</em>.</p></li>
<li><p>We can also pass column numbers instead of names in the <code>LHS</code>, although it is good programming practice to use column names.</p></li>
<li>
<p>When there is just one column to delete, we can drop the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> and double quotes and just use the column name <em>unquoted</em>, for convenience. That is:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">flights[, delay <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</a></code></pre></div>
<p>is equivalent to the code above.</p>
</li>
</ul>
</div>
</div>
<div id="ref-j-by" class="section level3">
<h3 class="hasAnchor">
<a href="#ref-j-by" class="anchor"></a>d) <code>:=</code> along with grouping using <code>by</code>
</h3>
<p>We have already seen the use of <code>i</code> along with <code>:=</code> in <a href="#ref-i-j">Section 2b</a>. Let’s now see how we can use <code>:=</code> along with <code>by</code>.</p>
<div id="how-can-we-add-a-new-column-which-contains-for-each-origdest-pair-the-maximum-speed" class="section level4">
<h4 class="hasAnchor">
<a href="#how-can-we-add-a-new-column-which-contains-for-each-origdest-pair-the-maximum-speed" class="anchor"></a>– How can we add a new column which contains for each <code>orig,dest</code> pair the maximum speed?</h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">flights[, max_speed <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(speed), by =<span class="st"> </span>.(origin, dest)]</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(flights)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="co">#    year month day dep_delay arr_delay carrier origin dest air_time distance hour    speed max_speed</span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co"># 1: 2014     1   1        14        13      AA    JFK  LAX      359     2475    9 413.6490  526.5957</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co"># 2: 2014     1   1        -3        13      AA    JFK  LAX      363     2475   11 409.0909  526.5957</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co"># 3: 2014     1   1         2         9      AA    JFK  LAX      351     2475   19 423.0769  526.5957</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co"># 4: 2014     1   1        -8       -26      AA    LGA  PBI      157     1035    7 395.5414  517.5000</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co"># 5: 2014     1   1         2         1      AA    JFK  LAX      350     2475   13 424.2857  526.5957</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="co"># 6: 2014     1   1         4         0      AA    EWR  LAX      339     2454   18 434.3363  518.4507</span></a></code></pre></div>
</div>
<div id="section-7" class="section level4 bs-callout bs-callout-info">
<h4></h4>
<ul>
<li><p>We add a new column <code>max_speed</code> using the <code>:=</code> operator by reference.</p></li>
<li><p>We provide the columns to group by the same way as shown in the <em>Introduction to data.table</em> vignette. For each group, <code><a href="https://rdrr.io/r/base/Extremes.html">max(speed)</a></code> is computed, which returns a single value. That value is recycled to fit the length of the group. Once again, no copies are being made at all. <code>flights</code> <em>data.table</em> is modified <em>in-place</em>.</p></li>
<li><p>We could have also provided <code>by</code> with a <em>character vector</em> as we saw in the <em>Introduction to data.table</em> vignette, e.g., <code>by = c("origin", "dest")</code>.</p></li>
</ul>
</div>
</div>
</div>
<div id="section-8" class="section level1">
<h1></h1>
<div id="e-multiple-columns-and" class="section level3">
<h3 class="hasAnchor">
<a href="#e-multiple-columns-and" class="anchor"></a>e) Multiple columns and <code>:=</code>
</h3>
<div id="how-can-we-add-two-more-columns-computing-max-of-dep_delay-and-arr_delay-for-each-month-using--sd" class="section level4">
<h4 class="hasAnchor">
<a href="#how-can-we-add-two-more-columns-computing-max-of-dep_delay-and-arr_delay-for-each-month-using--sd" class="anchor"></a>– How can we add two more columns computing <code>max()</code> of <code>dep_delay</code> and <code>arr_delay</code> for each month, using <code>.SD</code>?</h4>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">in_cols  =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"dep_delay"</span>, <span class="st">"arr_delay"</span>)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">out_cols =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"max_dep_delay"</span>, <span class="st">"max_arr_delay"</span>)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">flights[, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(out_cols) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(.SD, max), by =<span class="st"> </span>month, .SDcols =<span class="st"> </span>in_cols]</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(flights)</a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co">#    year month day dep_delay arr_delay carrier origin dest air_time distance hour    speed max_speed</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co"># 1: 2014     1   1        14        13      AA    JFK  LAX      359     2475    9 413.6490  526.5957</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co"># 2: 2014     1   1        -3        13      AA    JFK  LAX      363     2475   11 409.0909  526.5957</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="co"># 3: 2014     1   1         2         9      AA    JFK  LAX      351     2475   19 423.0769  526.5957</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co"># 4: 2014     1   1        -8       -26      AA    LGA  PBI      157     1035    7 395.5414  517.5000</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co"># 5: 2014     1   1         2         1      AA    JFK  LAX      350     2475   13 424.2857  526.5957</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co"># 6: 2014     1   1         4         0      AA    EWR  LAX      339     2454   18 434.3363  518.4507</span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">#    max_dep_delay max_arr_delay</span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co"># 1:           973           996</span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co"># 2:           973           996</span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="co"># 3:           973           996</span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="co"># 4:           973           996</span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="co"># 5:           973           996</span></a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="co"># 6:           973           996</span></a></code></pre></div>
</div>
<div id="section-9" class="section level4 bs-callout bs-callout-info">
<h4></h4>
<ul>
<li><p>We use the <code><a href="../reference/assign.html">LHS := RHS</a></code> form. We store the input column names and the new columns to add in separate variables and provide them to <code>.SDcols</code> and for <code>LHS</code> (for better readability).</p></li>
<li><p>Note that since we allow assignment by reference without quoting column names when there is only one column as explained in <a href="#delete-convenience">Section 2c</a>, we can not do <code><a href="../reference/assign.html">out_cols := lapply(.SD, max)</a></code>. That would result in adding one new column named <code>out_col</code>. Instead we should do either <code><a href="https://rdrr.io/r/base/c.html">c(out_cols)</a></code> or simply <code>(out_cols)</code>. Wrapping the variable name with <code>(</code> is enough to differentiate between the two cases.</p></li>
<li><p>The <code><a href="../reference/assign.html">LHS := RHS</a></code> form allows us to operate on multiple columns. In the RHS, to compute the <code>max</code> on columns specified in <code>.SDcols</code>, we make use of the base function <code><a href="https://rdrr.io/r/base/lapply.html">lapply()</a></code> along with <code>.SD</code> in the same way as we have seen before in the <em>“Introduction to data.table”</em> vignette. It returns a list of two elements, containing the maximum value corresponding to <code>dep_delay</code> and <code>arr_delay</code> for each group.</p></li>
</ul>
</div>
</div>
</div>
<div id="section-10" class="section level1">
<h1></h1>
<p>Before moving on to the next section, let’s clean up the newly created columns <code>speed</code>, <code>max_speed</code>, <code>max_dep_delay</code> and <code>max_arr_delay</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># RHS gets automatically recycled to length of LHS</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2">flights[, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"speed"</span>, <span class="st">"max_speed"</span>, <span class="st">"max_dep_delay"</span>, <span class="st">"max_arr_delay"</span>) <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(flights)</a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co">#    year month day dep_delay arr_delay carrier origin dest air_time distance hour</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co"># 1: 2014     1   1        14        13      AA    JFK  LAX      359     2475    9</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="co"># 2: 2014     1   1        -3        13      AA    JFK  LAX      363     2475   11</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co"># 3: 2014     1   1         2         9      AA    JFK  LAX      351     2475   19</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="co"># 4: 2014     1   1        -8       -26      AA    LGA  PBI      157     1035    7</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="co"># 5: 2014     1   1         2         1      AA    JFK  LAX      350     2475   13</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co"># 6: 2014     1   1         4         0      AA    EWR  LAX      339     2454   18</span></a></code></pre></div>
<div id="and-copy" class="section level2">
<h2 class="hasAnchor">
<a href="#and-copy" class="anchor"></a>3) <code>:=</code> and <code>copy()</code>
</h2>
<p><code>:=</code> modifies the input object by reference. Apart from the features we have discussed already, sometimes we might want to use the update by reference feature for its side effect. And at other times it may not be desirable to modify the original object, in which case we can use <code><a href="../reference/copy.html">copy()</a></code> function, as we will see in a moment.</p>
<div id="a-for-its-side-effect" class="section level3">
<h3 class="hasAnchor">
<a href="#a-for-its-side-effect" class="anchor"></a>a) <code>:=</code> for its side effect</h3>
<p>Let’s say we would like to create a function that would return the <em>maximum speed</em> for each month. But at the same time, we would also like to add the column <code>speed</code> to <em>flights</em>. We could write a simple function as follows:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">foo &lt;-<span class="st"> </span><span class="cf">function</span>(DT) {</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">  DT[, speed <span class="op">:</span><span class="er">=</span><span class="st"> </span>distance <span class="op">/</span><span class="st"> </span>(air_time<span class="op">/</span><span class="dv">60</span>)]</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">  DT[, .(<span class="dt">max_speed =</span> <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(speed)), by =<span class="st"> </span>month]</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">ans =<span class="st"> </span><span class="kw">foo</span>(flights)</a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(flights)</a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="co">#    year month day dep_delay arr_delay carrier origin dest air_time distance hour    speed</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="co"># 1: 2014     1   1        14        13      AA    JFK  LAX      359     2475    9 413.6490</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co"># 2: 2014     1   1        -3        13      AA    JFK  LAX      363     2475   11 409.0909</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co"># 3: 2014     1   1         2         9      AA    JFK  LAX      351     2475   19 423.0769</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="co"># 4: 2014     1   1        -8       -26      AA    LGA  PBI      157     1035    7 395.5414</span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co"># 5: 2014     1   1         2         1      AA    JFK  LAX      350     2475   13 424.2857</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="co"># 6: 2014     1   1         4         0      AA    EWR  LAX      339     2454   18 434.3363</span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(ans)</a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="co">#    month max_speed</span></a>
<a class="sourceLine" id="cb16-16" data-line-number="16"><span class="co"># 1:     1  535.6425</span></a>
<a class="sourceLine" id="cb16-17" data-line-number="17"><span class="co"># 2:     2  535.6425</span></a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="co"># 3:     3  549.0756</span></a>
<a class="sourceLine" id="cb16-19" data-line-number="19"><span class="co"># 4:     4  585.6000</span></a>
<a class="sourceLine" id="cb16-20" data-line-number="20"><span class="co"># 5:     5  544.2857</span></a>
<a class="sourceLine" id="cb16-21" data-line-number="21"><span class="co"># 6:     6  608.5714</span></a></code></pre></div>
<div id="section-11" class="section level4 bs-callout bs-callout-info">
<h4></h4>
<ul>
<li><p>Note that the new column <code>speed</code> has been added to <code>flights</code> <em>data.table</em>. This is because <code>:=</code> performs operations by reference. Since <code>DT</code> (the function argument) and <code>flights</code> refer to the same object in memory, modifying <code>DT</code> also reflects on <code>flights</code>.</p></li>
<li><p>And <code>ans</code> contains the maximum speed for each month.</p></li>
</ul>
</div>
</div>
<div id="b-the-copy-function" class="section level3">
<h3 class="hasAnchor">
<a href="#b-the-copy-function" class="anchor"></a>b) The <code>copy()</code> function</h3>
<p>In the previous section, we used <code>:=</code> for its side effect. But of course this may not be always desirable. Sometimes, we would like to pass a <em>data.table</em> object to a function, and might want to use the <code>:=</code> operator, but <em>wouldn’t</em> want to update the original object. We can accomplish this using the function <code><a href="../reference/copy.html">copy()</a></code>.</p>
<div id="section-12" class="section level4 bs-callout bs-callout-info">
<h4></h4>
<p>The <code><a href="../reference/copy.html">copy()</a></code> function <em>deep</em> copies the input object and therefore any subsequent update by reference operations performed on the copied object will not affect the original object.</p>
</div>
</div>
</div>
</div>
<div id="section-13" class="section level1">
<h1></h1>
<p>There are two particular places where <code><a href="../reference/copy.html">copy()</a></code> function is essential:</p>
<ol style="list-style-type: decimal">
<li>
<p>Contrary to the situation we have seen in the previous point, we may not want the input data.table to a function to be modified <em>by reference</em>. As an example, let’s consider the task in the previous section, except we don’t want to modify <code>flights</code> by reference.</p>
<p>Let’s first delete the <code>speed</code> column we generated in the previous section.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">flights[, speed <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</a></code></pre></div>
<p>Now, we could accomplish the task as follows:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">foo &lt;-<span class="st"> </span><span class="cf">function</span>(DT) {</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">  DT &lt;-<span class="st"> </span><span class="kw"><a href="../reference/copy.html">copy</a></span>(DT)                              ## deep copy</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">  DT[, speed <span class="op">:</span><span class="er">=</span><span class="st"> </span>distance <span class="op">/</span><span class="st"> </span>(air_time<span class="op">/</span><span class="dv">60</span>)]     ## doesn't affect 'flights'</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">  DT[, .(<span class="dt">max_speed =</span> <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(speed)), by =<span class="st"> </span>month]</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">ans &lt;-<span class="st"> </span><span class="kw">foo</span>(flights)</a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(flights)</a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co">#    year month day dep_delay arr_delay carrier origin dest air_time distance hour</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="co"># 1: 2014     1   1        14        13      AA    JFK  LAX      359     2475    9</span></a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="co"># 2: 2014     1   1        -3        13      AA    JFK  LAX      363     2475   11</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="co"># 3: 2014     1   1         2         9      AA    JFK  LAX      351     2475   19</span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="co"># 4: 2014     1   1        -8       -26      AA    LGA  PBI      157     1035    7</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"><span class="co"># 5: 2014     1   1         2         1      AA    JFK  LAX      350     2475   13</span></a>
<a class="sourceLine" id="cb18-14" data-line-number="14"><span class="co"># 6: 2014     1   1         4         0      AA    EWR  LAX      339     2454   18</span></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(ans)</a>
<a class="sourceLine" id="cb18-16" data-line-number="16"><span class="co">#    month max_speed</span></a>
<a class="sourceLine" id="cb18-17" data-line-number="17"><span class="co"># 1:     1  535.6425</span></a>
<a class="sourceLine" id="cb18-18" data-line-number="18"><span class="co"># 2:     2  535.6425</span></a>
<a class="sourceLine" id="cb18-19" data-line-number="19"><span class="co"># 3:     3  549.0756</span></a>
<a class="sourceLine" id="cb18-20" data-line-number="20"><span class="co"># 4:     4  585.6000</span></a>
<a class="sourceLine" id="cb18-21" data-line-number="21"><span class="co"># 5:     5  544.2857</span></a>
<a class="sourceLine" id="cb18-22" data-line-number="22"><span class="co"># 6:     6  608.5714</span></a></code></pre></div>
</li>
</ol>
<div id="section-14" class="section level4 bs-callout bs-callout-info">
<h4></h4>
<ul>
<li><p>Using <code><a href="../reference/copy.html">copy()</a></code> function did not update <code>flights</code> <em>data.table</em> by reference. It doesn’t contain the column <code>speed</code>.</p></li>
<li><p>And <code>ans</code> contains the maximum speed corresponding to each month.</p></li>
</ul>
<p>However we could improve this functionality further by <em>shallow</em> copying instead of <em>deep</em> copying. In fact, we would very much like to <a href="https://github.com/Rdatatable/data.table/issues/617">provide this functionality for <code>v1.9.8</code></a>. We will touch up on this again in the <em>data.table design</em> vignette.</p>
</div>
</div>
<div id="section-15" class="section level1">
<h1></h1>
<ol start="2" style="list-style-type: decimal">
<li>
<p>When we store the column names on to a variable, e.g., <code>DT_n = names(DT)</code>, and then <em>add/update/delete</em> column(s) <em>by reference</em>. It would also modify <code>DT_n</code>, unless we do <code><a href="../reference/copy.html">copy(names(DT))</a></code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">DT =<span class="st"> </span><span class="kw"><a href="../reference/data.table.html">data.table</a></span>(<span class="dt">x =</span> 1L, <span class="dt">y =</span> 2L)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">DT_n =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(DT)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">DT_n</a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co"># [1] "x" "y"</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"></a>
<a class="sourceLine" id="cb19-6" data-line-number="6">## add a new column by reference</a>
<a class="sourceLine" id="cb19-7" data-line-number="7">DT[, z <span class="op">:</span><span class="er">=</span><span class="st"> </span>3L]</a>
<a class="sourceLine" id="cb19-8" data-line-number="8"></a>
<a class="sourceLine" id="cb19-9" data-line-number="9">## DT_n also gets updated</a>
<a class="sourceLine" id="cb19-10" data-line-number="10">DT_n</a>
<a class="sourceLine" id="cb19-11" data-line-number="11"><span class="co"># [1] "x" "y" "z"</span></a>
<a class="sourceLine" id="cb19-12" data-line-number="12"></a>
<a class="sourceLine" id="cb19-13" data-line-number="13">## use `copy()`</a>
<a class="sourceLine" id="cb19-14" data-line-number="14">DT_n =<span class="st"> </span><span class="kw"><a href="../reference/copy.html">copy</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(DT))</a>
<a class="sourceLine" id="cb19-15" data-line-number="15">DT[, w <span class="op">:</span><span class="er">=</span><span class="st"> </span>4L]</a>
<a class="sourceLine" id="cb19-16" data-line-number="16"></a>
<a class="sourceLine" id="cb19-17" data-line-number="17">## DT_n doesn't get updated</a>
<a class="sourceLine" id="cb19-18" data-line-number="18">DT_n</a>
<a class="sourceLine" id="cb19-19" data-line-number="19"><span class="co"># [1] "x" "y" "z"</span></a></code></pre></div>
</li>
</ol>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<div id="the-operator" class="section level4 bs-callout bs-callout-info">
<h4 class="hasAnchor">
<a href="#the-operator" class="anchor"></a>The <code>:=</code> operator</h4>
<ul>
<li><p>It is used to <em>add/update/delete</em> columns by reference.</p></li>
<li><p>We have also seen how to use <code>:=</code> along with <code>i</code> and <code>by</code> the same way as we have seen in the <em>Introduction to data.table</em> vignette. We can in the same way use <code>keyby</code>, chain operations together, and pass expressions to <code>by</code> as well all in the same way. The syntax is <em>consistent</em>.</p></li>
<li><p>We can use <code>:=</code> for its side effect or use <code><a href="../reference/copy.html">copy()</a></code> to not modify the original object while updating by reference.</p></li>
</ul>
</div>
</div>
</div>
<div id="section-16" class="section level1">
<h1></h1>
<p>So far we have seen a whole lot in <code>j</code>, and how to combine it with <code>by</code> and little of <code>i</code>. Let’s turn our attention back to <code>i</code> in the next vignette <em>“Keys and fast binary search based subset”</em> to perform <em>blazing fast subsets</em> by <em>keying data.tables</em>.</p>
<hr>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data">Data</a></li>
      <li><a href="#introduction">Introduction</a></li>
      <li><a href="#reference-semantics">1. Reference semantics</a></li>
      <li><a href="#section"></a></li>
      <li><a href="#section-2"></a></li>
      <li>
<a href="#section-4"></a><ul class="nav nav-pills nav-stacked">
<li><a href="#addupdatedelete-columns-by-reference">2. Add/update/delete columns <em>by reference</em></a></li>
      </ul>
</li>
      <li><a href="#section-6"></a></li>
      <li><a href="#section-8"></a></li>
      <li>
<a href="#section-10"></a><ul class="nav nav-pills nav-stacked">
<li><a href="#and-copy">3) <code>:=</code> and <code>copy()</code></a></li>
      </ul>
</li>
      <li><a href="#section-13"></a></li>
      <li>
<a href="#section-15"></a><ul class="nav nav-pills nav-stacked">
<li><a href="#summary">Summary</a></li>
      </ul>
</li>
      <li><a href="#section-16"></a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Matt Dowle, Arun Srinivasan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
