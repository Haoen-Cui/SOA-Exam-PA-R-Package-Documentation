<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Faster match of character vectors — chmatch • data.table</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Faster match of character vectors — chmatch" />
<meta property="og:description" content="chmatch returns a vector of the positions of (first) matches of its first argument in its second. Both arguments must be character vectors.
%chin% is like %in%, but for character vectors." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">data.table</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.12.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-archive fa-lg"></span>
     
    R Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../../boot/index.html">boot</a>
    </li>
    <li>
      <a href="../../broom/index.html">broom</a>
    </li>
    <li>
      <a href="../../caret/index.html">caret</a>
    </li>
    <li>
      <a href="../../cluster/index.html">cluster</a>
    </li>
    <li>
      <a href="../../coefplot/index.html">coefplot</a>
    </li>
    <li>
      <a href="../../data.table/index.html">data.table</a>
    </li>
    <li>
      <a href="../../devtools/index.html">devtools</a>
    </li>
    <li>
      <a href="../../dplyr/index.html">dplyr</a>
    </li>
    <li>
      <a href="../../e1071/index.html">e1071</a>
    </li>
    <li>
      <a href="../../forcats/index.html">forcats</a>
    </li>
    <li>
      <a href="../../gbm/index.html">gbm</a>
    </li>
    <li>
      <a href="../../ggplot2/index.html">ggplot2</a>
    </li>
    <li>
      <a href="../../glmnet/index.html">glmnet</a>
    </li>
    <li>
      <a href="../../gridExtra/index.html">gridExtra</a>
    </li>
    <li>
      <a href="../../ISLR/index.html">ISLR</a>
    </li>
    <li>
      <a href="../../MASS/index.html">MASS</a>
    </li>
    <li>
      <a href="../../pdp/index.html">pdp</a>
    </li>
    <li>
      <a href="../../pls/index.html">pls</a>
    </li>
    <li>
      <a href="../../plyr/index.html">plyr</a>
    </li>
    <li>
      <a href="../../pROC/index.html">pROC</a>
    </li>
    <li>
      <a href="../../purrr/index.html">purrr</a>
    </li>
    <li>
      <a href="../../randomForest/index.html">randomForest</a>
    </li>
    <li>
      <a href="../../readr/index.html">readr</a>
    </li>
    <li>
      <a href="../../rpart/index.html">rpart</a>
    </li>
    <li>
      <a href="../../rpart.plot/index.html">rpart.plot</a>
    </li>
    <li>
      <a href="../../stringr/index.html">stringr</a>
    </li>
    <li>
      <a href="../../tibble/index.html">tibble</a>
    </li>
    <li>
      <a href="../../tidyr/index.html">tidyr</a>
    </li>
    <li>
      <a href="../../xgboost/index.html">xgboost</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/datatable-benchmarking.html">Benchmarking data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-faq.html">Frequently Asked Questions about data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-importing.html">Importing data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-intro.html">Introduction to data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-keys-fast-subset.html">Keys and fast binary search based subset</a>
    </li>
    <li>
      <a href="../articles/datatable-reference-semantics.html">Reference semantics</a>
    </li>
    <li>
      <a href="../articles/datatable-reshape.html">Efficient reshaping using data.tables</a>
    </li>
    <li>
      <a href="../articles/datatable-sd-usage.html">Using .SD for Data Analysis</a>
    </li>
    <li>
      <a href="../articles/datatable-secondary-indices-and-auto-indexing.html">Secondary indices and auto indexing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Rdatatable/data.table">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Faster match of character vectors</h1>
    
    <div class="hidden name"><code>chmatch.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>chmatch</code> returns a vector of the positions of (first) matches of its first argument in its second. Both arguments must be character vectors.</p>
<p><code>%chin%</code> is like <code>%in%</code>, but for character vectors.</p>
    </div>

    <pre class="usage"><span class='fu'>chmatch</span>(<span class='no'>x</span>, <span class='no'>table</span>, <span class='kw'>nomatch</span><span class='kw'>=</span><span class='fl'>NA_integer_</span>)
<span class='no'>x</span> <span class='kw'>%chin%</span> <span class='no'>table</span>
<span class='fu'>chorder</span>(<span class='no'>x</span>)
<span class='fu'>chgroup</span>(<span class='no'>x</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>character vector: the values to be matched, or the values to be ordered or grouped</p></td>
    </tr>
    <tr>
      <th>table</th>
      <td><p>character vector: the values to be matched against.</p></td>
    </tr>
    <tr>
      <th>nomatch</th>
      <td><p>the value to be returned in the case when no match is found. Note that it is coerced to integer.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Fast versions of <code>match</code>, <code>%in%</code> and <code>order</code>, optimised for character vectors. <code>chgroup</code> groups together duplicated values but retains the group order (according the first appearance order of each group), efficiently. They have been primarily developed for internal use by data.table, but have been exposed since that seemed appropriate.</p>
<p>Strings are already cached internally by R (<code>CHARSXP</code>) and that is utilised by these functions. No hash table is built or cached, so the first call is the same speed as subsequent calls. Essentially, a counting sort (similar to <code><a href='https://rdrr.io/r/base/order.html'>base::sort.list(x,method="radix")</a></code>, see <code><a href='setkey.html'>setkey</a></code>) is implemented using the (almost) unused truelength of CHARSXP as the counter. <em>Where</em> R <em>has</em> used truelength of CHARSXP (where a character value is shared by a variable name), the non zero truelengths are stored first and reinstated afterwards. Each of the <code>ch*</code> functions implements a variation on this theme. Remember that internally in R, length of a CHARSXP is the nchar of the string and DATAPTR is the string itself.</p>
<p>Methods that do build and cache a hash table (such as the <a href='https://cran.r-project.org/package=fastmatch'>fastmatch package</a>) are <em>much</em> faster on subsequent calls (almost instant) but a little slower on the first. Therefore <code>chmatch</code> may be particularly suitable for ephemeral vectors (such as local variables in functions) or tasks that are only done once. Much depends on the length of <code>x</code> and <code>table</code>, how many unique strings each contains, and whether the position of the first match is all that is required.</p>
<p>It may be possible to speed up fastmatch's hash table build time by using the technique in <code>data.table</code>, and we have suggested this to its author. If successful, fastmatch would then be fastest in all cases.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>As <code>match</code> and <code>%in%</code>. <code>chorder</code> and <code>chgroup</code> return an integer index vector.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://rdrr.io/r/base/match.html'>match</a></code>, <code><a href='https://rdrr.io/r/base/match.html'>%in%</a></code></p></div>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>The name <code>charmatch</code> was taken by <code><a href='https://rdrr.io/r/base/charmatch.html'>charmatch</a></code>, hence <code>chmatch</code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Please type 'example(chmatch)' to run this and see timings on your machine</span>

<span class='no'>N</span> <span class='kw'>=</span> <span class='fl'>1e5</span>
<span class='co'># N is set small here (1e5) to reduce runtime because every day CRAN runs and checks</span>
<span class='co'># all documentation examples in addition to the package's test suite.</span>
<span class='co'># The comments here apply when N has been changed to 1e8 and were run on 2018-05-13</span>
<span class='co'># with R 3.5.0 and data.table 1.11.2.</span>

<span class='no'>u</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/hexmode.html'>as.hexmode</a></span>(<span class='fl'>1</span>:<span class='fl'>10000</span>))
<span class='no'>y</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='no'>u</span>,<span class='no'>N</span>,<span class='kw'>replace</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='no'>x</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='no'>u</span>)
                                           <span class='co'>#  With N=1e8 ...</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>a</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/match.html'>match</a></span>(<span class='no'>x</span>,<span class='no'>y</span>))               <span class='co'>#  4.6s</span></div><div class='output co'>#&gt;    user  system elapsed 
#&gt;   0.000   0.003   0.003 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>b</span> <span class='kw'>&lt;-</span> <span class='fu'>chmatch</span>(<span class='no'>x</span>,<span class='no'>y</span>))             <span class='co'>#  1.8s</span></div><div class='output co'>#&gt;    user  system elapsed 
#&gt;   0.001   0.000   0.001 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='no'>a</span>,<span class='no'>b</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>a</span> <span class='kw'>&lt;-</span> <span class='no'>x</span> <span class='kw'>%in%</span> <span class='no'>y</span>)               <span class='co'>#  4.5s</span></div><div class='output co'>#&gt;    user  system elapsed 
#&gt;   0.002   0.000   0.002 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>b</span> <span class='kw'>&lt;-</span> <span class='no'>x</span> <span class='kw'>%chin%</span> <span class='no'>y</span>)             <span class='co'>#  1.7s</span></div><div class='output co'>#&gt;    user  system elapsed 
#&gt;   0.001   0.000   0.001 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='no'>a</span>,<span class='no'>b</span>)</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'># Different example with more unique strings ...</span>
<span class='no'>u</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/hexmode.html'>as.hexmode</a></span>(<span class='fl'>1</span>:(<span class='no'>N</span>/<span class='fl'>10</span>)))
<span class='no'>y</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='no'>u</span>,<span class='no'>N</span>,<span class='kw'>replace</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='no'>x</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='no'>u</span>,<span class='no'>N</span>,<span class='kw'>replace</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>a</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/match.html'>match</a></span>(<span class='no'>x</span>,<span class='no'>y</span>))               <span class='co'># 46s</span></div><div class='output co'>#&gt;    user  system elapsed 
#&gt;   0.004   0.000   0.005 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>b</span> <span class='kw'>&lt;-</span> <span class='fu'>chmatch</span>(<span class='no'>x</span>,<span class='no'>y</span>))             <span class='co'># 16s</span></div><div class='output co'>#&gt;    user  system elapsed 
#&gt;   0.001   0.000   0.002 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='no'>a</span>,<span class='no'>b</span>)</div><div class='output co'>#&gt; [1] TRUE</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#note">Note</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Matt Dowle, Arun Srinivasan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


