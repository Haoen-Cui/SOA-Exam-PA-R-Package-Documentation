<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Optimisations in data.table — datatable.optimize • data.table</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Optimisations in data.table — datatable.optimize" />
<meta property="og:description" content="data.table internally optimises certain expressions in order to improve
performance. This section briefly summarises those optimisations.
Note that there's no additional input needed from the user to take advantage
of these optimisations. They happen automatically.
Run the code under the example section to get a feel for the performance
benefits from these optimisations." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">data.table</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.12.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-archive fa-lg"></span>
     
    R Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../../boot/index.html">boot</a>
    </li>
    <li>
      <a href="../../broom/index.html">broom</a>
    </li>
    <li>
      <a href="../../caret/index.html">caret</a>
    </li>
    <li>
      <a href="../../cluster/index.html">cluster</a>
    </li>
    <li>
      <a href="../../coefplot/index.html">coefplot</a>
    </li>
    <li>
      <a href="../../data.table/index.html">data.table</a>
    </li>
    <li>
      <a href="../../devtools/index.html">devtools</a>
    </li>
    <li>
      <a href="../../dplyr/index.html">dplyr</a>
    </li>
    <li>
      <a href="../../e1071/index.html">e1071</a>
    </li>
    <li>
      <a href="../../forcats/index.html">forcats</a>
    </li>
    <li>
      <a href="../../gbm/index.html">gbm</a>
    </li>
    <li>
      <a href="../../ggplot2/index.html">ggplot2</a>
    </li>
    <li>
      <a href="../../glmnet/index.html">glmnet</a>
    </li>
    <li>
      <a href="../../gridExtra/index.html">gridExtra</a>
    </li>
    <li>
      <a href="../../ISLR/index.html">ISLR</a>
    </li>
    <li>
      <a href="../../MASS/index.html">MASS</a>
    </li>
    <li>
      <a href="../../pdp/index.html">pdp</a>
    </li>
    <li>
      <a href="../../pls/index.html">pls</a>
    </li>
    <li>
      <a href="../../plyr/index.html">plyr</a>
    </li>
    <li>
      <a href="../../pROC/index.html">pROC</a>
    </li>
    <li>
      <a href="../../purrr/index.html">purrr</a>
    </li>
    <li>
      <a href="../../randomForest/index.html">randomForest</a>
    </li>
    <li>
      <a href="../../readr/index.html">readr</a>
    </li>
    <li>
      <a href="../../rpart/index.html">rpart</a>
    </li>
    <li>
      <a href="../../rpart.plot/index.html">rpart.plot</a>
    </li>
    <li>
      <a href="../../stringr/index.html">stringr</a>
    </li>
    <li>
      <a href="../../tibble/index.html">tibble</a>
    </li>
    <li>
      <a href="../../tidyr/index.html">tidyr</a>
    </li>
    <li>
      <a href="../../xgboost/index.html">xgboost</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/datatable-benchmarking.html">Benchmarking data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-faq.html">Frequently Asked Questions about data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-importing.html">Importing data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-intro.html">Introduction to data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-keys-fast-subset.html">Keys and fast binary search based subset</a>
    </li>
    <li>
      <a href="../articles/datatable-reference-semantics.html">Reference semantics</a>
    </li>
    <li>
      <a href="../articles/datatable-reshape.html">Efficient reshaping using data.tables</a>
    </li>
    <li>
      <a href="../articles/datatable-sd-usage.html">Using .SD for Data Analysis</a>
    </li>
    <li>
      <a href="../articles/datatable-secondary-indices-and-auto-indexing.html">Secondary indices and auto indexing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Rdatatable/data.table">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Optimisations in data.table</h1>
    
    <div class="hidden name"><code>datatable-optimize.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>data.table</code> internally optimises certain expressions in order to improve
performance. This section briefly summarises those optimisations.</p>
<p>Note that there's no additional input needed from the user to take advantage
of these optimisations. They happen automatically.</p>
<p>Run the code under the <em>example</em> section to get a feel for the performance
benefits from these optimisations.</p>
    </div>



    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>data.table</code> reads the global option <code>datatable.optimize</code> to figure
out what level of optimisation is required. The default value <code>Inf</code>
activates <em>all</em> available optimisations.</p>
<p>At optimisation level <code>&gt;= 1</code>, i.e., <code><a href='https://rdrr.io/r/base/options.html'>getOption("datatable.optimize")</a></code>
&gt;= 1, these are the optimisations:</p>
<ul>
<li><p>The base function <code>order</code> is internally replaced with
    <code>data.table</code>'s <em>fast ordering</em>. That is, <code>DT[order(...)]</code>
    gets internally optimised to <code>DT[forder(...)]</code>.</p></li>
<li><p>The expression <code>DT[, lapply(.SD, fun), by=.]</code> gets optimised
    to <code>DT[, list(fun(a), fun(b), ...), by=.]</code> where <code>a,b, ...</code> are
    columns in <code>.SD</code>. This improves performance tremendously.</p></li>
<li><p>Similarly, the expression <code>DT[, c(.N, lapply(.SD, fun)), by=.]</code>
    gets optimised to <code>DT[, list(.N, fun(a), fun(b), ...)]</code>. <code>.N</code> is
    just for example here.</p></li>
<li><p><code><a href='https://rdrr.io/r/base/mean.html'>base::mean</a></code> function is internally optimised to use
    <code>data.table</code>'s <code>fastmean</code> function. <code><a href='https://rdrr.io/r/base/mean.html'>mean()</a></code> from <code>base</code>
    is an S3 generic and gets slow with many groups.</p></li>
</ul>

<p>At optimisation level <code>&gt;= 2</code>, i.e., <code><a href='https://rdrr.io/r/base/options.html'>getOption("datatable.optimize")</a></code> &gt;= 2, additional optimisations are implemented on top of the optimisations already shown above.</p>
<ul>
<li><p>Expressions in <code>j</code> which contain only the functions
    <code>min, max, mean, median, var, sd, sum, prod, first, last, head, tail</code> (for example,
    <code>DT[, list(mean(x), median(x), min(y), max(y)), by=z]</code>), they are very
    effectively optimised using what we call <em>GForce</em>. These functions
    are automatically replaced with a corresponding GForce version
    with pattern <code>g*</code>, e.g., <code>prod</code> becomes <code>gprod</code>.</p>
<p>Normally, once the rows belonging to each group are identified, the values
    corresponding to the group are gathered and the <code>j</code>-expression is
    evaluated. This can be improved by computing the result directly without
    having to gather the values or evaluating the expression for each group
    (which can get costly with large number of groups) by implementing it
    specifically for a particular function. As a result, it is extremely fast.</p></li>
<li><p>In addition to all the functions above, `.N` is also optimised to
    use GForce, when used separately or when combined with the functions mentioned
    above. Note further that GForce-optimized functions must be used separately,
    i.e., code like <code>DT[ , max(x) - min(x), by=z]</code> will <em>not</em> currently
    be optimized to use <code>gmax, gmin</code>.</p></li>
<li><p>Expressions of the form <code>DT[i, j, by]</code> are also optimised when
    <code>i</code> is a <em>subset</em> operation and <code>j</code> is any/all of the functions
    discussed above.</p></li>
</ul>

<p>At optimisation level <code>&gt;= 3</code>, i.e., <code><a href='https://rdrr.io/r/base/options.html'>getOption("datatable.optimize")</a></code> &gt;= 3, additional optimisations for subsets in i are implemented on top of the optimisations already shown above. Subsetting operations are - if possible - translated into joins to make use of blazing fast binary search using indices and keys. The following queries are optimized:</p>
<ul>
<li><p>Supported operators: <code>==</code>, <code>%in%</code>. Non-equi operators(&gt;, &lt;, etc.) are not supported yet because non-equi joins are slower than vector based subsets.</p></li>
<li><p>Queries on multiple columns are supported, if the connector is '<code>&amp;</code>', e.g. <code>DT[x == 2 &amp; y == 3]</code> is supported, but <code>DT[x == 2 | y == 3]</code> is not.</p></li>
<li><p>Optimization will currently be turned off when doing subset when cross product of elements provided to filter on exceeds &gt; 1e4. This most likely happens if multiple <code>%in%</code>, or <code>%chin%</code> queries are combined, e.g. <code>DT[x %in% 1:100 &amp; y %in% 1:200]</code> will not be optimized since <code>100 * 200 = 2e4 &gt; 1e4</code>.</p></li>
<li><p>Queries with multiple criteria on one column are <em>not</em> supported, e.g. <code>DT[x == 2 &amp; x %in% c(2,5)]</code> is not supported.</p></li>
<li><p>Queries with non-missing j are supported, e.g. <code>DT[x == 3 &amp; y == 5, .(new = x-y)]</code> or <code>DT[x == 3 &amp; y == 5, new := x-y]</code> are supported. Also extends to queries using <code>with = FALSE</code>.</p></li>
<li><p>"notjoin" queries, i.e. queries that start with <code>!</code>, are only supported if there are no <code>&amp;</code> connections, e.g. <code>DT[!x==3]</code> is supported, but <code>DT[!x==3 &amp; y == 4]</code> is not.</p></li>
</ul>

<p>If in doubt, whether your query benefits from optimization, call it with the <code>verbose = TRUE</code> argument. You should see "Optimized subsetting...".</p>
<p><b>Auto indexing:</b> In case a query is optimized, but no appropriate key or index is found, <code>data.table</code> automatically creates an <em>index</em> on the first run. Any successive subsets on the same
column then reuse this index to <em>binary search</em> (instead of
<em>vector scan</em>) and is therefore fast.
Auto indexing can be switched off with the global option
<code><a href='https://rdrr.io/r/base/options.html'>options(datatable.auto.index = FALSE)</a></code>. To switch off using existing
indices set global option <code><a href='https://rdrr.io/r/base/options.html'>options(datatable.use.index = FALSE)</a></code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='setNumericRounding.html'>setNumericRounding</a></code>, <code><a href='setNumericRounding.html'>getNumericRounding</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'># Generate a big data.table with a relatively many columns</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>1L</span>)
<span class='no'>DT</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='fl'>1</span>:<span class='fl'>20</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(-<span class='fl'>100</span>:<span class='fl'>100</span>), <span class='fl'>5e6L</span>, <span class='fl'>TRUE</span>))
<span class='fu'><a href='setDT.html'>setDT</a></span>(<span class='no'>DT</span>)[, <span class='no'>id</span> <span class='kw'>:=</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span>(<span class='fl'>1e5</span>, <span class='fl'>5e6</span>, <span class='fl'>TRUE</span>)]
<span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span>(<span class='fu'><a href='https://rdrr.io/r/utils/object.size.html'>object.size</a></span>(<span class='no'>DT</span>), <span class='kw'>units</span><span class='kw'>=</span><span class='st'>"Mb"</span>) <span class='co'># 400MB, not huge, but will do</span>

<span class='co'># 'order' optimisation</span>
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span>(<span class='kw'>datatable.optimize</span> <span class='kw'>=</span> <span class='fl'>1L</span>) <span class='co'># optimisation 'on'</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>ans1</span> <span class='kw'>&lt;-</span> <span class='no'>DT</span>[<span class='fu'><a href='setorder.html'>order</a></span>(<span class='no'>id</span>)])
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span>(<span class='kw'>datatable.optimize</span> <span class='kw'>=</span> <span class='fl'>0L</span>) <span class='co'># optimisation 'off'</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>ans2</span> <span class='kw'>&lt;-</span> <span class='no'>DT</span>[<span class='fu'><a href='setorder.html'>order</a></span>(<span class='no'>id</span>)])
<span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='no'>ans1</span>, <span class='no'>ans2</span>)

<span class='co'># optimisation of 'lapply(.SD, fun)'</span>
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span>(<span class='kw'>datatable.optimize</span> <span class='kw'>=</span> <span class='fl'>1L</span>) <span class='co'># optimisation 'on'</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>ans1</span> <span class='kw'>&lt;-</span> <span class='no'>DT</span>[, <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>.SD</span>, <span class='no'>min</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>id</span>])
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span>(<span class='kw'>datatable.optimize</span> <span class='kw'>=</span> <span class='fl'>0L</span>) <span class='co'># optimisation 'off'</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>ans2</span> <span class='kw'>&lt;-</span> <span class='no'>DT</span>[, <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>.SD</span>, <span class='no'>min</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>id</span>])
<span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='no'>ans1</span>, <span class='no'>ans2</span>)

<span class='co'># optimisation of 'mean'</span>
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span>(<span class='kw'>datatable.optimize</span> <span class='kw'>=</span> <span class='fl'>1L</span>) <span class='co'># optimisation 'on'</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>ans1</span> <span class='kw'>&lt;-</span> <span class='no'>DT</span>[, <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>.SD</span>, <span class='no'>mean</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>id</span>])
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>ans2</span> <span class='kw'>&lt;-</span> <span class='no'>DT</span>[, <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>.SD</span>, <span class='kw pkg'>base</span><span class='kw ns'>::</span><span class='no'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>id</span>])
<span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='no'>ans1</span>, <span class='no'>ans2</span>)

<span class='co'># optimisation of 'c(.N, lapply(.SD, ))'</span>
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span>(<span class='kw'>datatable.optimize</span> <span class='kw'>=</span> <span class='fl'>1L</span>) <span class='co'># optimisation 'on'</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>ans1</span> <span class='kw'>&lt;-</span> <span class='no'>DT</span>[, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>.N</span>, <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>.SD</span>, <span class='no'>min</span>)), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>id</span>])
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span>(<span class='kw'>datatable.optimize</span> <span class='kw'>=</span> <span class='fl'>0L</span>) <span class='co'># optimisation 'off'</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>ans2</span> <span class='kw'>&lt;-</span> <span class='no'>DT</span>[, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='kw'>N</span><span class='kw'>=</span><span class='no'>.N</span>, <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>.SD</span>, <span class='no'>min</span>)), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>id</span>])
<span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='no'>ans1</span>, <span class='no'>ans2</span>)

<span class='co'># GForce</span>
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span>(<span class='kw'>datatable.optimize</span> <span class='kw'>=</span> <span class='fl'>2L</span>) <span class='co'># optimisation 'on'</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>ans1</span> <span class='kw'>&lt;-</span> <span class='no'>DT</span>[, <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>.SD</span>, <span class='no'>median</span>), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>id</span>])
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>ans2</span> <span class='kw'>&lt;-</span> <span class='no'>DT</span>[, <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>.SD</span>, <span class='kw'>function</span>(<span class='no'>x</span>) <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='kw pkg'>stats</span><span class='kw ns'>::</span><span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span>(<span class='no'>x</span>))), <span class='kw'>by</span><span class='kw'>=</span><span class='no'>id</span>])
<span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span>(<span class='no'>ans1</span>, <span class='no'>ans2</span>)

<span class='co'># optimized subsets</span>
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span>(<span class='kw'>datatable.optimize</span> <span class='kw'>=</span> <span class='fl'>2L</span>)
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>ans1</span> <span class='kw'>&lt;-</span> <span class='no'>DT</span>[<span class='no'>id</span> <span class='kw'>==</span> <span class='fl'>100L</span>]) <span class='co'># vector scan</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>ans2</span> <span class='kw'>&lt;-</span> <span class='no'>DT</span>[<span class='no'>id</span> <span class='kw'>==</span> <span class='fl'>100L</span>]) <span class='co'># vector scan</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>DT</span>[<span class='no'>id</span> <span class='kw'>%in%</span> <span class='fl'>100</span>:<span class='fl'>500</span>])    <span class='co'># vector scan</span>

<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span>(<span class='kw'>datatable.optimize</span> <span class='kw'>=</span> <span class='fl'>3L</span>)
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>ans1</span> <span class='kw'>&lt;-</span> <span class='no'>DT</span>[<span class='no'>id</span> <span class='kw'>==</span> <span class='fl'>100L</span>]) <span class='co'># index + binary search subset</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>ans2</span> <span class='kw'>&lt;-</span> <span class='no'>DT</span>[<span class='no'>id</span> <span class='kw'>==</span> <span class='fl'>100L</span>]) <span class='co'># only binary search subset</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='no'>DT</span>[<span class='no'>id</span> <span class='kw'>%in%</span> <span class='fl'>100</span>:<span class='fl'>500</span>])    <span class='co'># only binary search subset again</span>

}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#details">Details</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Matt Dowle, Arun Srinivasan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


