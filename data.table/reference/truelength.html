<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Over-allocation access — truelength • data.table</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Over-allocation access — truelength" />
<meta property="og:description" content="These functions are experimental and somewhat advanced. By experimental we mean their names might change and perhaps the syntax, argument names and types. So if you write a lot of code using them, you have been warned! They should work and be stable, though, so please report problems with them. alloc.col is just an alias to setalloccol. We recommend to use setalloccol (though alloc.col will continue to be supported) because the set* prefix in setalloccol makes it clear that its input argument is modified in-place." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">data.table</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.12.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-archive fa-lg"></span>
     
    R Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../../boot/index.html">boot</a>
    </li>
    <li>
      <a href="../../broom/index.html">broom</a>
    </li>
    <li>
      <a href="../../caret/index.html">caret</a>
    </li>
    <li>
      <a href="../../cluster/index.html">cluster</a>
    </li>
    <li>
      <a href="../../coefplot/index.html">coefplot</a>
    </li>
    <li>
      <a href="../../data.table/index.html">data.table</a>
    </li>
    <li>
      <a href="../../devtools/index.html">devtools</a>
    </li>
    <li>
      <a href="../../dplyr/index.html">dplyr</a>
    </li>
    <li>
      <a href="../../e1071/index.html">e1071</a>
    </li>
    <li>
      <a href="../../forcats/index.html">forcats</a>
    </li>
    <li>
      <a href="../../gbm/index.html">gbm</a>
    </li>
    <li>
      <a href="../../ggplot2/index.html">ggplot2</a>
    </li>
    <li>
      <a href="../../glmnet/index.html">glmnet</a>
    </li>
    <li>
      <a href="../../gridExtra/index.html">gridExtra</a>
    </li>
    <li>
      <a href="../../ISLR/index.html">ISLR</a>
    </li>
    <li>
      <a href="../../MASS/index.html">MASS</a>
    </li>
    <li>
      <a href="../../pdp/index.html">pdp</a>
    </li>
    <li>
      <a href="../../pls/index.html">pls</a>
    </li>
    <li>
      <a href="../../plyr/index.html">plyr</a>
    </li>
    <li>
      <a href="../../pROC/index.html">pROC</a>
    </li>
    <li>
      <a href="../../purrr/index.html">purrr</a>
    </li>
    <li>
      <a href="../../randomForest/index.html">randomForest</a>
    </li>
    <li>
      <a href="../../readr/index.html">readr</a>
    </li>
    <li>
      <a href="../../rpart/index.html">rpart</a>
    </li>
    <li>
      <a href="../../rpart.plot/index.html">rpart.plot</a>
    </li>
    <li>
      <a href="../../stringr/index.html">stringr</a>
    </li>
    <li>
      <a href="../../tibble/index.html">tibble</a>
    </li>
    <li>
      <a href="../../tidyr/index.html">tidyr</a>
    </li>
    <li>
      <a href="../../xgboost/index.html">xgboost</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/datatable-benchmarking.html">Benchmarking data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-faq.html">Frequently Asked Questions about data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-importing.html">Importing data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-intro.html">Introduction to data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-keys-fast-subset.html">Keys and fast binary search based subset</a>
    </li>
    <li>
      <a href="../articles/datatable-reference-semantics.html">Reference semantics</a>
    </li>
    <li>
      <a href="../articles/datatable-reshape.html">Efficient reshaping using data.tables</a>
    </li>
    <li>
      <a href="../articles/datatable-sd-usage.html">Using .SD for Data Analysis</a>
    </li>
    <li>
      <a href="../articles/datatable-secondary-indices-and-auto-indexing.html">Secondary indices and auto indexing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Rdatatable/data.table">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Over-allocation access</h1>
    
    <div class="hidden name"><code>truelength.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>These functions are experimental and somewhat advanced. By <em>experimental</em> we mean their names might change and perhaps the syntax, argument names and types. So if you write a lot of code using them, you have been warned! They should work and be stable, though, so please report problems with them. <code>alloc.col</code> is just an alias to <code>setalloccol</code>. We recommend to use <code>setalloccol</code> (though <code>alloc.col</code> will continue to be supported) because the <code>set*</code> prefix in <code>setalloccol</code> makes it clear that its input argument is modified in-place.</p>
    </div>

    <pre class="usage"><span class='fu'>truelength</span>(<span class='no'>x</span>)
<span class='fu'>setalloccol</span>(<span class='no'>DT</span>,
    <span class='kw'>n</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"datatable.alloccol"</span>),        <span class='co'># default: 1024L</span>
    <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"datatable.verbose"</span>))   <span class='co'># default: FALSE</span>
<span class='fu'>alloc.col</span>(<span class='no'>DT</span>,
    <span class='kw'>n</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"datatable.alloccol"</span>),        <span class='co'># default: 1024L</span>
    <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"datatable.verbose"</span>))   <span class='co'># default: FALSE</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>Any type of vector, including <code>data.table</code> which is a <code>list</code> vector of column pointers.</p></td>
    </tr>
    <tr>
      <th>DT</th>
      <td><p>A <code>data.table</code>.</p></td>
    </tr>
    <tr>
      <th>n</th>
      <td><p>The number of spare column pointer slots to ensure are available. If <code>DT</code> is a 1,000 column <code>data.table</code> with 24 spare slots remaining, <code>n=1024L</code> means grow the 24 spare slots to be 1024. <code>truelength(DT)</code> will then be 2024 in this example.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>Output status and information.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>When adding columns by reference using <code>:=</code>, we <em>could</em> simply create a new column list vector (one longer) and memcpy over the old vector, with no copy of the column vectors themselves. That requires negligible use of space and time, and is what v1.7.2 did.  However, that copy of the list vector of column pointers only (but not the columns themselves), a <em>shallow copy</em>, resulted in inconsistent behaviour in some circumstances. So, as from v1.7.3 data.table over allocates the list vector of column pointers so that columns can be added fully by reference, consistently.</p>
<p>When the allocated column pointer slots are used up, to add a new column <code>data.table</code> must reallocate that vector. If two or more variables are bound to the same data.table this shallow copy may or may not be desirable, but we don't think this will be a problem very often (more discussion may be required on data.table issue tracker). Setting <code><a href='https://rdrr.io/r/base/options.html'>options(datatable.verbose=TRUE)</a></code> includes messages if and when a shallow copy is taken. To avoid shallow copies there are several options: use <code><a href='copy.html'>copy</a></code> to make a deep copy first, use <code>setalloccol</code> to reallocate in advance, or, change the default allocation rule (perhaps in your .Rprofile); e.g., <code><a href='https://rdrr.io/r/base/options.html'>options(datatable.alloccol=10000L)</a></code>.</p>
<p>Please note : over allocation of the column pointer vector is not for efficiency <em>per se</em>; it is so that <code>:=</code> can add columns by reference without a shallow copy.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>truelength(x)</code> returns the length of the vector allocated in memory. <code><a href='https://rdrr.io/r/base/length.html'>length(x)</a></code> of those items are in use. Currently, it is just the list vector of column pointers that is over-allocated (i.e. <code>truelength(DT)</code>), not the column vectors themselves, which would in future allow fast row <code>insert()</code>. For tables loaded from disk however, <code>truelength</code> is 0 in <span style="R">R</span> 2.14.0+ (and random in <span style="R">R</span> &lt;= 2.13.2), which is perhaps unexpected. <code>data.table</code> detects this state and over-allocates the loaded <code>data.table</code> when the next column addition occurs. All other operations on <code>data.table</code> (such as fast grouping and joins) do not need <code>truelength</code>.</p>
<p><code>setalloccol</code> <em>reallocates</em> <code>DT</code> by reference. This may be useful for efficiency if you know you are about to going to add a lot of columns in a loop. It also returns the new <code>DT</code>, for convenience in compound queries.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='copy.html'>copy</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>DT</span> <span class='kw'>=</span> <span class='fu'><a href='data.table.html'>data.table</a></span>(<span class='kw'>a</span><span class='kw'>=</span><span class='fl'>1</span>:<span class='fl'>3</span>,<span class='kw'>b</span><span class='kw'>=</span><span class='fl'>4</span>:<span class='fl'>6</span>)
<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>DT</span>)                 <span class='co'># 2 column pointer slots used</span></div><div class='output co'>#&gt; [1] 2</div><div class='input'><span class='fu'>truelength</span>(<span class='no'>DT</span>)             <span class='co'># 1026 column pointer slots allocated</span></div><div class='output co'>#&gt; [1] 1026</div><div class='input'><span class='fu'>setalloccol</span>(<span class='no'>DT</span>, <span class='fl'>2048</span>)</div><div class='output co'>#&gt;    a b
#&gt; 1: 1 4
#&gt; 2: 2 5
#&gt; 3: 3 6</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>DT</span>)                 <span class='co'># 2 used</span></div><div class='output co'>#&gt; [1] 2</div><div class='input'><span class='fu'>truelength</span>(<span class='no'>DT</span>)             <span class='co'># 2050 allocated, 2048 free</span></div><div class='output co'>#&gt; [1] 2050</div><div class='input'><span class='no'>DT</span>[,<span class='no'>c</span><span class='kw'>:=</span><span class='fl'>7L</span>]                 <span class='co'># add new column by assigning to spare slot</span></div><div class='output co'>#&gt;    a b c
#&gt; 1: 1 4 7
#&gt; 2: 2 5 7
#&gt; 3: 3 6 7</div><div class='input'><span class='fu'>truelength</span>(<span class='no'>DT</span>)-<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>DT</span>)  <span class='co'># 2047 slots spare</span></div><div class='output co'>#&gt; [1] 2047</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Matt Dowle, Arun Srinivasan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


