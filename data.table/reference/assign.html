<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Assignment by reference — := • data.table</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Assignment by reference — :=" />
<meta property="og:description" content="Fast add, remove and update subsets of columns, by reference. := operator can be used in two ways: LHS := RHS form, and Functional form. See Usage.
set is a low-overhead loop-able version of :=. It is particularly useful for repetitively updating rows of certain columns by reference (using a for-loop). See Examples. It can not perform grouping operations." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">data.table</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.12.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa fas fa-archive fa-lg"></span>
     
    R Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../../boot/index.html">boot</a>
    </li>
    <li>
      <a href="../../broom/index.html">broom</a>
    </li>
    <li>
      <a href="../../caret/index.html">caret</a>
    </li>
    <li>
      <a href="../../cluster/index.html">cluster</a>
    </li>
    <li>
      <a href="../../coefplot/index.html">coefplot</a>
    </li>
    <li>
      <a href="../../data.table/index.html">data.table</a>
    </li>
    <li>
      <a href="../../devtools/index.html">devtools</a>
    </li>
    <li>
      <a href="../../dplyr/index.html">dplyr</a>
    </li>
    <li>
      <a href="../../e1071/index.html">e1071</a>
    </li>
    <li>
      <a href="../../forcats/index.html">forcats</a>
    </li>
    <li>
      <a href="../../gbm/index.html">gbm</a>
    </li>
    <li>
      <a href="../../ggplot2/index.html">ggplot2</a>
    </li>
    <li>
      <a href="../../glmnet/index.html">glmnet</a>
    </li>
    <li>
      <a href="../../gridExtra/index.html">gridExtra</a>
    </li>
    <li>
      <a href="../../ISLR/index.html">ISLR</a>
    </li>
    <li>
      <a href="../../MASS/index.html">MASS</a>
    </li>
    <li>
      <a href="../../pdp/index.html">pdp</a>
    </li>
    <li>
      <a href="../../pls/index.html">pls</a>
    </li>
    <li>
      <a href="../../plyr/index.html">plyr</a>
    </li>
    <li>
      <a href="../../pROC/index.html">pROC</a>
    </li>
    <li>
      <a href="../../purrr/index.html">purrr</a>
    </li>
    <li>
      <a href="../../randomForest/index.html">randomForest</a>
    </li>
    <li>
      <a href="../../readr/index.html">readr</a>
    </li>
    <li>
      <a href="../../rpart/index.html">rpart</a>
    </li>
    <li>
      <a href="../../rpart.plot/index.html">rpart.plot</a>
    </li>
    <li>
      <a href="../../stringr/index.html">stringr</a>
    </li>
    <li>
      <a href="../../tibble/index.html">tibble</a>
    </li>
    <li>
      <a href="../../tidyr/index.html">tidyr</a>
    </li>
    <li>
      <a href="../../xgboost/index.html">xgboost</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/datatable-benchmarking.html">Benchmarking data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-faq.html">Frequently Asked Questions about data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-importing.html">Importing data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-intro.html">Introduction to data.table</a>
    </li>
    <li>
      <a href="../articles/datatable-keys-fast-subset.html">Keys and fast binary search based subset</a>
    </li>
    <li>
      <a href="../articles/datatable-reference-semantics.html">Reference semantics</a>
    </li>
    <li>
      <a href="../articles/datatable-reshape.html">Efficient reshaping using data.tables</a>
    </li>
    <li>
      <a href="../articles/datatable-sd-usage.html">Using .SD for Data Analysis</a>
    </li>
    <li>
      <a href="../articles/datatable-secondary-indices-and-auto-indexing.html">Secondary indices and auto indexing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/Rdatatable/data.table">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Assignment by reference</h1>
    
    <div class="hidden name"><code>assign.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fast add, remove and update subsets of columns, by reference. <code>:=</code> operator can be used in two ways: <code>LHS := RHS</code> form, and <code>Functional form</code>. See <code>Usage</code>.</p>
<p><code>set</code> is a low-overhead loop-able version of <code>:=</code>. It is particularly useful for repetitively updating rows of certain columns by reference (using a for-loop). See <code>Examples</code>. It can not perform grouping operations.</p>
    </div>

    <pre class="usage"><span class='co'># 1. LHS := RHS form</span>
<span class='co'># DT[i, LHS := RHS, by = \dots]</span>
<span class='co'># DT[i, c("LHS1", "LHS2") := list(RHS1, RHS2), by = \dots]</span>

<span class='co'># 2. Functional form</span>
<span class='co'># DT[i, `:=`(LHS1 = RHS1,</span>
<span class='co'>#            LHS2 = RHS2,</span>
<span class='co'>#            \dots), by = \dots]</span>

<span class='fu'>set</span>(<span class='no'>x</span>, <span class='kw'>i</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>j</span>, <span class='no'>value</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>LHS</th>
      <td><p>A character vector of column names (or numeric positions) or a variable that evaluates as such. If the column doesn't exist, it is added, <em>by reference</em>.</p></td>
    </tr>
    <tr>
      <th>RHS</th>
      <td><p>A list of replacement values. It is recycled in the usual way to fill the number of rows satisfying <code>i</code>, if any.  To remove a column use <code>NULL</code>.</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>A <code>data.table</code>. Or, <code>set()</code> accepts <code>data.frame</code>, too.</p></td>
    </tr>
    <tr>
      <th>i</th>
      <td><p>Optional. Indicates the rows on which the values must be updated with. If not provided, implies <em>all rows</em>. The <code>:=</code> form is more powerful as it allows <em>subsets</em> and <code>joins</code> based add/update columns by reference. See <code>Details</code>.</p>
<p>In <code>set</code>, only integer type is allowed in <code>i</code> indicating which rows <code>value</code> should be assigned to. <code>NULL</code> represents all rows more efficiently than creating a vector such as <code>1:nrow(x)</code>.</p></td>
    </tr>
    <tr>
      <th>j</th>
      <td><p>Column name(s) (character) or number(s) (integer) to be assigned <code>value</code> when column(s) already exist, and only column name(s) if they are to be created.</p></td>
    </tr>
    <tr>
      <th>value</th>
      <td><p>A list of replacement values to assign by reference to <code>x[i, j]</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>:=</code> is defined for use in <code>j</code> only. It <em>adds</em> or <em>updates</em> or <em>removes</em> column(s) by reference. It makes no copies of any part of memory at all. Please read <a href='../doc/datatable-reference-semantics.html'><code><a href='../articles/datatable-reference-semantics.html'>vignette("datatable-reference-semantics")</a></code></a> and follow with examples. Some typical usages are:</p>
<pre>
    DT[, col := val]                              # update (or add at the end if doesn't exist) a column called "col" with value "val" (recycled if necessary).
    DT[i, col := val]                             # same as above, but only for those rows specified in i and (for new columns) NA elsewhere.
    DT[i, "col a" := val]                         # same. column is called "col a"
    DT[i, (3:6) := val]                           # update existing columns 3:6 with value. Aside: parens are not required here since : already makes LHS a call rather than a symbol.
    DT[i, colvector := val, with = FALSE]         # OLD syntax. The contents of "colvector" in calling scope determine the column(s).
    DT[i, (colvector) := val]                     # same (NOW PREFERRED) shorthand syntax. The parens are enough to stop the LHS being a symbol; same as c(colvector).
    DT[i, colC := mean(colB), by = colA]          # update (or add) column called "colC" by reference by group. A major feature of `:=`.
    DT[,`:=`(new1 = sum(colB), new2 = sum(colC))] # Functional form
</pre>

<p>The <code><a href='last.updated.html'>.Last.updated</a></code> variable contains the number of rows updated by the most recent <code>:=</code> or <code>set</code> calls, which may be useful, for example, in production settings for testing assumptions about the number of rows affected by a statement; see <code><a href='last.updated.html'>.Last.updated</a></code> for details.</p>
<p>Note that for efficiency no check is performed for duplicate assignments, i.e. if multiple values are passed for assignment to the same index, assignment to this index will occur repeatedly and sequentially; for a given use case, consider whether it makes sense to create your own test for duplicates, e.g. in production code.</p>
<p>All of the following result in a friendly error (by design) :</p>
<pre>
    x := 1L
    DT[i, col] := val
    DT[i]$col := val
    DT[, {col1 := 1L; col2 := 2L}]                # Use the functional form, `:=`(), instead (see above).
</pre>

<p>For additional resources, please read <a href='../doc/datatable-faq.html'><code><a href='../articles/datatable-faq.html'>vignette("datatable-faq")</a></code></a>. Also have a look at StackOverflow's <a href='http://stackoverflow.com/search?q=%5Bdata.table%5D+reference'>data.table tag</a>.</p>
<p><code>:=</code> in <code>j</code> can be combined with all types of <code>i</code> (such as binary search), and all types of <code>by</code>. This a one reason why <code>:=</code> has been implemented in <code>j</code>. Please see <a href='../doc/datatable-reference-semantics'><code><a href='../articles/datatable-reference-semantics.html'>vignette("datatable-reference-semantics")</a></code></a> and also <code>FAQ 2.16</code> for analogies to SQL.</p>
<p>When <code>LHS</code> is a factor column and <code>RHS</code> is a character vector with items missing from the factor levels, the new level(s) are automatically added (by reference, efficiently), unlike base methods.</p>
<p>Unlike <code>&lt;-</code> for <code>data.frame</code>, the (potentially large) LHS is not coerced to match the type of the (often small) RHS. Instead the RHS is coerced to match the type of the LHS, if necessary. Where this involves double precision values being coerced to an integer column, a warning is given (whether or not fractional data is truncated). The motivation for this is efficiency. It is best to get the column types correct up front and stick to them. Changing a column type is possible but deliberately harder: provide a whole column as the RHS. This RHS is then <em>plonked</em> into that column slot and we call this <em>plonk syntax</em>, or <em>replace column syntax</em> if you prefer. By needing to construct a full length vector of a new type, you as the user are more aware of what is happening, and it is clearer to readers of your code that you really do intend to change the column type.</p>
<p><code>data.table</code>s are <em>not</em> copied-on-change by <code>:=</code>, <code>setkey</code> or any of the other <code>set*</code> functions. See <code><a href='copy.html'>copy</a></code>.</p>
    <h2 class="hasAnchor" id="advanced-internals-"><a class="anchor" href="#advanced-internals-"></a>Advanced (internals):</h2>

    <p>It is easy to see how <em>sub-assigning</em> to existing columns is done internally. Removing columns by reference is also straightforward by modifying the vector of column pointers only (using memmove in C). However adding (new) columns is more tricky as to how the <code>data.table</code> can be grown <em>by reference</em>: the list vector of column pointers is <em>over-allocated</em>, see <code><a href='truelength.html'>truelength</a></code>. By defining <code>:=</code> in <code>j</code> we believe update syntax is natural, and scales, but it also bypasses <code>[&lt;-</code> dispatch and allows <code>:=</code> to update by reference with no copies of any part of memory at all.</p>
<p>Since <code>[.data.table</code> incurs overhead to check the existence and type of arguments (for example), <code>set()</code> provides direct (but less flexible) assignment by reference with low overhead, appropriate for use inside a <code>for</code> loop. See examples. <code>:=</code> is more powerful and flexible than <code>set()</code> because <code>:=</code> is intended to be combined with <code>i</code> and <code>by</code> in single queries on large datasets.</p>
    <h2 class="hasAnchor" id="note-"><a class="anchor" href="#note-"></a>Note:</h2>

    <p><code>DT[a &gt; 4, b := c]</code> is different from <code>DT[a &gt; 4][, b := c]</code>. The first expression updates (or adds) column <code>b</code> with the value <code>c</code> on those rows where <code>a &gt; 4</code> evaluates to <code>TRUE</code>. <code>X</code> is updated <em>by reference</em>, therefore no assignment needed.</p>
<p>The second expression on the other hand updates a <em>new</em> <code>data.table</code> that's returned by the subset operation. Since the subsetted data.table is ephemeral (it is not assigned to a symbol), the result would be lost; unless the result is assigned, for example, as follows: <code>ans &lt;- DT[a &gt; 4][, b := c]</code>.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>DT</code> is modified by reference and returned invisibly. If you require a copy, take a <code><a href='copy.html'>copy</a></code> first (using <code>DT2 = copy(DT)</code>).</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='data.table.html'>data.table</a></code>, <code><a href='copy.html'>copy</a></code>, <code><a href='truelength.html'>setalloccol</a></code>, <code><a href='truelength.html'>truelength</a></code>, <code>set</code>, <code><a href='last.updated.html'>.Last.updated</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>DT</span> <span class='kw'>=</span> <span class='fu'><a href='data.table.html'>data.table</a></span>(<span class='kw'>a</span> <span class='kw'>=</span> <span class='no'>LETTERS</span>[<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>3L</span>,<span class='fl'>1</span>:<span class='fl'>3</span>)], <span class='kw'>b</span> <span class='kw'>=</span> <span class='fl'>4</span>:<span class='fl'>7</span>)
<span class='no'>DT</span>[, <span class='no'>c</span> <span class='kw'>:=</span> <span class='fl'>8</span>]                <span class='co'># add a numeric column, 8 for all rows</span></div><div class='output co'>#&gt;    a b c
#&gt; 1: C 4 8
#&gt; 2: A 5 8
#&gt; 3: B 6 8
#&gt; 4: C 7 8</div><div class='input'><span class='no'>DT</span>[, <span class='no'>d</span> <span class='kw'>:=</span> <span class='fl'>9L</span>]               <span class='co'># add an integer column, 9L for all rows</span></div><div class='output co'>#&gt;    a b c d
#&gt; 1: C 4 8 9
#&gt; 2: A 5 8 9
#&gt; 3: B 6 8 9
#&gt; 4: C 7 8 9</div><div class='input'><span class='no'>DT</span>[, <span class='no'>c</span> <span class='kw'>:=</span> <span class='kw'>NULL</span>]             <span class='co'># remove column c</span></div><div class='output co'>#&gt;    a b d
#&gt; 1: C 4 9
#&gt; 2: A 5 9
#&gt; 3: B 6 9
#&gt; 4: C 7 9</div><div class='input'><span class='no'>DT</span>[<span class='fl'>2</span>, <span class='no'>d</span> <span class='kw'>:=</span> -<span class='fl'>8L</span>]             <span class='co'># subassign by reference to d; 2nd row is -8L now</span></div><div class='output co'>#&gt;    a b  d
#&gt; 1: C 4  9
#&gt; 2: A 5 -8
#&gt; 3: B 6  9
#&gt; 4: C 7  9</div><div class='input'><span class='no'>DT</span>                          <span class='co'># DT changed by reference</span></div><div class='output co'>#&gt;    a b  d
#&gt; 1: C 4  9
#&gt; 2: A 5 -8
#&gt; 3: B 6  9
#&gt; 4: C 7  9</div><div class='input'><span class='no'>DT</span>[<span class='fl'>2</span>, <span class='no'>d</span> <span class='kw'>:=</span> <span class='fl'>10L</span>][]           <span class='co'># shorthand for update and print</span></div><div class='output co'>#&gt;    a b  d
#&gt; 1: C 4  9
#&gt; 2: A 5 10
#&gt; 3: B 6  9
#&gt; 4: C 7  9</div><div class='input'>
<span class='no'>DT</span>[<span class='no'>b</span> <span class='kw'>&gt;</span> <span class='fl'>4</span>, <span class='no'>b</span> <span class='kw'>:=</span> <span class='no'>d</span> * <span class='fl'>2L</span>]      <span class='co'># subassign to b with d*2L on those rows where b &gt; 4 is TRUE</span></div><div class='output co'>#&gt;    a  b  d
#&gt; 1: C  4  9
#&gt; 2: A 20 10
#&gt; 3: B 18  9
#&gt; 4: C 18  9</div><div class='input'><span class='no'>DT</span>[<span class='no'>b</span> <span class='kw'>&gt;</span> <span class='fl'>4</span>][, <span class='no'>b</span> <span class='kw'>:=</span> <span class='no'>d</span> * <span class='fl'>2L</span>]    <span class='co'># different from above. [, := ] is performed on the subset</span></div><div class='output co'>#&gt;    a  b  d
#&gt; 1: A 20 10
#&gt; 2: B 18  9
#&gt; 3: C 18  9</div><div class='input'>                            <span class='co'># which is an new (ephemeral) data.table. Result needs to be</span>
                            <span class='co'># assigned to a variable (using `&lt;-`).</span>

<span class='no'>DT</span>[, <span class='no'>e</span> <span class='kw'>:=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>d</span>), <span class='kw'>by</span> <span class='kw'>=</span> <span class='no'>a</span>]  <span class='co'># add new column by group by reference</span></div><div class='output co'>#&gt;    a  b  d  e
#&gt; 1: C  4  9  9
#&gt; 2: A 20 10 10
#&gt; 3: B 18  9  9
#&gt; 4: C 18  9  9</div><div class='input'><span class='no'>DT</span>[<span class='st'>"A"</span>, <span class='no'>b</span> <span class='kw'>:=</span> <span class='fl'>0L</span>, <span class='kw'>on</span> <span class='kw'>=</span> <span class='st'>"a"</span>]  <span class='co'># ad-hoc update of column b for group "A" using</span></div><div class='output co'>#&gt;    a  b  d  e
#&gt; 1: C  4  9  9
#&gt; 2: A  0 10 10
#&gt; 3: B 18  9  9
#&gt; 4: C 18  9  9</div><div class='input'>                            <span class='co'># joins-as-subsets with binary search and 'on='</span>
<span class='co'># same as above but using keys</span>
<span class='fu'><a href='setkey.html'>setkey</a></span>(<span class='no'>DT</span>, <span class='no'>a</span>)
<span class='no'>DT</span>[<span class='st'>"A"</span>, <span class='no'>b</span> <span class='kw'>:=</span> <span class='fl'>0L</span>]            <span class='co'># binary search for group "A" and set column b using keys</span></div><div class='output co'>#&gt;    a  b  d  e
#&gt; 1: A  0 10 10
#&gt; 2: B 18  9  9
#&gt; 3: C  4  9  9
#&gt; 4: C 18  9  9</div><div class='input'><span class='no'>DT</span>[<span class='st'>"B"</span>, <span class='no'>f</span> <span class='kw'>:=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span>(<span class='no'>d</span>)]       <span class='co'># subassign to new column, NA initialized</span></div><div class='output co'>#&gt;    a  b  d  e  f
#&gt; 1: A  0 10 10 NA
#&gt; 2: B 18  9  9  9
#&gt; 3: C  4  9  9 NA
#&gt; 4: C 18  9  9 NA</div><div class='input'>
<span class='co'># Adding multiple columns</span>
<span class='co'>## by name</span>
<span class='no'>DT</span>[ , <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'sin_d'</span>, <span class='st'>'log_e'</span>, <span class='st'>'cos_d'</span>) <span class='kw'>:=</span>
   <span class='fu'>.</span>(<span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>sin</a></span>(<span class='no'>d</span>), <span class='fu'><a href='https://rdrr.io/r/base/Log.html'>log</a></span>(<span class='no'>e</span>), <span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>cos</a></span>(<span class='no'>d</span>))]</div><div class='output co'>#&gt;    a  b  d  e  f      sin_d    log_e      cos_d
#&gt; 1: A  0 10 10 NA -0.5440211 2.302585 -0.8390715
#&gt; 2: B 18  9  9  9  0.4121185 2.197225 -0.9111303
#&gt; 3: C  4  9  9 NA  0.4121185 2.197225 -0.9111303
#&gt; 4: C 18  9  9 NA  0.4121185 2.197225 -0.9111303</div><div class='input'><span class='co'>## by patterned name</span>
<span class='no'>DT</span>[ , <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'sin'</span>, <span class='st'>'cos'</span>), <span class='st'>'b'</span>, <span class='kw'>sep</span> <span class='kw'>=</span> <span class='st'>'_'</span>) <span class='kw'>:=</span>
   <span class='fu'>.</span>(<span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>sin</a></span>(<span class='no'>b</span>), <span class='fu'><a href='https://rdrr.io/r/base/Trig.html'>cos</a></span>(<span class='no'>b</span>))]</div><div class='output co'>#&gt;    a  b  d  e  f      sin_d    log_e      cos_d      sin_b      cos_b
#&gt; 1: A  0 10 10 NA -0.5440211 2.302585 -0.8390715  0.0000000  1.0000000
#&gt; 2: B 18  9  9  9  0.4121185 2.197225 -0.9111303 -0.7509872  0.6603167
#&gt; 3: C  4  9  9 NA  0.4121185 2.197225 -0.9111303 -0.7568025 -0.6536436
#&gt; 4: C 18  9  9 NA  0.4121185 2.197225 -0.9111303 -0.7509872  0.6603167</div><div class='input'><span class='co'>## using lapply &amp; .SD</span>
<span class='no'>DT</span>[ , <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(<span class='st'>'tan_'</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'b'</span>, <span class='st'>'d'</span>, <span class='st'>'e'</span>)) <span class='kw'>:=</span>
   <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>.SD</span>, <span class='no'>tan</span>), <span class='kw'>.SDcols</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'b'</span>, <span class='st'>'d'</span>, <span class='st'>'e'</span>)]</div><div class='output co'>#&gt;    a  b  d  e  f      sin_d    log_e      cos_d      sin_b      cos_b     tan_b
#&gt; 1: A  0 10 10 NA -0.5440211 2.302585 -0.8390715  0.0000000  1.0000000  0.000000
#&gt; 2: B 18  9  9  9  0.4121185 2.197225 -0.9111303 -0.7509872  0.6603167 -1.137314
#&gt; 3: C  4  9  9 NA  0.4121185 2.197225 -0.9111303 -0.7568025 -0.6536436  1.157821
#&gt; 4: C 18  9  9 NA  0.4121185 2.197225 -0.9111303 -0.7509872  0.6603167 -1.137314
#&gt;         tan_d      tan_e
#&gt; 1:  0.6483608  0.6483608
#&gt; 2: -0.4523157 -0.4523157
#&gt; 3: -0.4523157 -0.4523157
#&gt; 4: -0.4523157 -0.4523157</div><div class='input'><span class='co'>## using forced evaluation to disambiguate a vector of names</span>
<span class='co'>##   and overwrite existing columns with their squares</span>
<span class='no'>sq_cols</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>'b'</span>, <span class='st'>'d'</span>, <span class='st'>'e'</span>)
<span class='no'>DT</span>[ , (<span class='no'>sq_cols</span>) <span class='kw'>:=</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>.SD</span>, <span class='no'>`^`</span>, <span class='fl'>2L</span>), <span class='kw'>.SDcols</span> <span class='kw'>=</span> <span class='no'>sq_cols</span>]</div><div class='output co'>#&gt;    a   b   d   e  f      sin_d    log_e      cos_d      sin_b      cos_b
#&gt; 1: A   0 100 100 NA -0.5440211 2.302585 -0.8390715  0.0000000  1.0000000
#&gt; 2: B 324  81  81  9  0.4121185 2.197225 -0.9111303 -0.7509872  0.6603167
#&gt; 3: C  16  81  81 NA  0.4121185 2.197225 -0.9111303 -0.7568025 -0.6536436
#&gt; 4: C 324  81  81 NA  0.4121185 2.197225 -0.9111303 -0.7509872  0.6603167
#&gt;        tan_b      tan_d      tan_e
#&gt; 1:  0.000000  0.6483608  0.6483608
#&gt; 2: -1.137314 -0.4523157 -0.4523157
#&gt; 3:  1.157821 -0.4523157 -0.4523157
#&gt; 4: -1.137314 -0.4523157 -0.4523157</div><div class='input'><span class='co'>## by integer (NB: for robustness, it is not recommended</span>
<span class='co'>##   to use explicit integers to update/define columns)</span>
<span class='no'>DT</span>[ , <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>2L</span>, <span class='fl'>3L</span>, <span class='fl'>4L</span>) <span class='kw'>:=</span> <span class='fu'>.</span>(<span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>b</span>), <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>d</span>), <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span>(<span class='no'>e</span>))]</div><div class='output co'>#&gt;    a  b  d  e  f      sin_d    log_e      cos_d      sin_b      cos_b     tan_b
#&gt; 1: A  0 10 10 NA -0.5440211 2.302585 -0.8390715  0.0000000  1.0000000  0.000000
#&gt; 2: B 18  9  9  9  0.4121185 2.197225 -0.9111303 -0.7509872  0.6603167 -1.137314
#&gt; 3: C  4  9  9 NA  0.4121185 2.197225 -0.9111303 -0.7568025 -0.6536436  1.157821
#&gt; 4: C 18  9  9 NA  0.4121185 2.197225 -0.9111303 -0.7509872  0.6603167 -1.137314
#&gt;         tan_d      tan_e
#&gt; 1:  0.6483608  0.6483608
#&gt; 2: -0.4523157 -0.4523157
#&gt; 3: -0.4523157 -0.4523157
#&gt; 4: -0.4523157 -0.4523157</div><div class='input'><span class='co'>## by implicit integer</span>
<span class='no'>DT</span>[ , <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span>(<span class='st'>'a$'</span>, <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>DT</span>)) <span class='kw'>:=</span> <span class='fu'><a href='https://rdrr.io/r/base/chartr.html'>tolower</a></span>(<span class='no'>a</span>)]</div><div class='output co'>#&gt;    a  b  d  e  f      sin_d    log_e      cos_d      sin_b      cos_b     tan_b
#&gt; 1: a  0 10 10 NA -0.5440211 2.302585 -0.8390715  0.0000000  1.0000000  0.000000
#&gt; 2: b 18  9  9  9  0.4121185 2.197225 -0.9111303 -0.7509872  0.6603167 -1.137314
#&gt; 3: c  4  9  9 NA  0.4121185 2.197225 -0.9111303 -0.7568025 -0.6536436  1.157821
#&gt; 4: c 18  9  9 NA  0.4121185 2.197225 -0.9111303 -0.7509872  0.6603167 -1.137314
#&gt;         tan_d      tan_e
#&gt; 1:  0.6483608  0.6483608
#&gt; 2: -0.4523157 -0.4523157
#&gt; 3: -0.4523157 -0.4523157
#&gt; 4: -0.4523157 -0.4523157</div><div class='input'><span class='co'>## by implicit integer, using forced evaluation</span>
<span class='no'>sq_col_idx</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/grep.html'>grep</a></span>(<span class='st'>'d$'</span>, <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span>(<span class='no'>DT</span>))
<span class='no'>DT</span>[ , (<span class='no'>sq_col_idx</span>) <span class='kw'>:=</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>.SD</span>, <span class='no'>dnorm</span>),
   <span class='kw'>.SDcols</span> <span class='kw'>=</span> <span class='no'>sq_col_idx</span>]</div><div class='output co'>#&gt;    a  b            d  e  f     sin_d    log_e     cos_d      sin_b      cos_b
#&gt; 1: a  0 7.694599e-23 10 NA 0.3440673 2.302585 0.2805624  0.0000000  1.0000000
#&gt; 2: b 18 1.027977e-18  9  9 0.3664624 2.197225 0.2634168 -0.7509872  0.6603167
#&gt; 3: c  4 1.027977e-18  9 NA 0.3664624 2.197225 0.2634168 -0.7568025 -0.6536436
#&gt; 4: c 18 1.027977e-18  9 NA 0.3664624 2.197225 0.2634168 -0.7509872  0.6603167
#&gt;        tan_b     tan_d      tan_e
#&gt; 1:  0.000000 0.3233162  0.6483608
#&gt; 2: -1.137314 0.3601505 -0.4523157
#&gt; 3:  1.157821 0.3601505 -0.4523157
#&gt; 4: -1.137314 0.3601505 -0.4523157</div><div class='input'>
<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'># Speed example:</span>

<span class='no'>m</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>matrix</a></span>(<span class='fl'>1</span>, <span class='kw'>nrow</span> <span class='kw'>=</span> <span class='fl'>2e6L</span>, <span class='kw'>ncol</span> <span class='kw'>=</span> <span class='fl'>100L</span>)
<span class='no'>DF</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.data.frame.html'>as.data.frame</a></span>(<span class='no'>m</span>)
<span class='no'>DT</span> <span class='kw'>=</span> <span class='fu'><a href='as.data.table.html'>as.data.table</a></span>(<span class='no'>m</span>)

<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='kw'>for</span> (<span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fl'>1000</span>) <span class='no'>DF</span>[<span class='no'>i</span>, <span class='fl'>1</span>] <span class='kw'>=</span> <span class='no'>i</span>)
<span class='co'># 15.856 seconds</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='kw'>for</span> (<span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fl'>1000</span>) <span class='no'>DT</span>[<span class='no'>i</span>, <span class='no'>V1</span> <span class='kw'>:=</span> <span class='no'>i</span>])
<span class='co'># 0.279 seconds  (57 times faster)</span>
<span class='fu'><a href='https://rdrr.io/r/base/system.time.html'>system.time</a></span>(<span class='kw'>for</span> (<span class='no'>i</span> <span class='kw'>in</span> <span class='fl'>1</span>:<span class='fl'>1000</span>) <span class='fu'>set</span>(<span class='no'>DT</span>, <span class='no'>i</span>, <span class='fl'>1L</span>, <span class='no'>i</span>))
<span class='co'># 0.002 seconds  (7930 times faster, overhead of [.data.table is avoided)</span>

<span class='co'># However, normally, we call [.data.table *once* on *large* data, not many times on small data.</span>
<span class='co'># The above is to demonstrate overhead, not to recommend looping in this way. But the option</span>
<span class='co'># of set() is there if you need it.</span>
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#advanced-internals-">Advanced (internals):</a></li>
      <li><a href="#note-">Note:</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Matt Dowle, Arun Srinivasan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


